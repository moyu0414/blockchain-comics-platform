{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Container,Card,Col,Row,Pagination,OverlayTrigger,Tooltip}from'react-bootstrap';import'./bootstrap.min.css';import{Link}from\"react-router-dom\";import{useTranslation}from'react-i18next';import i18n from'../i18n';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const website=process.env.REACT_APP_Website;const API_KEY=process.env.REACT_APP_API_KEY;function CollectionNft(){const[NFT,setNFT]=useState([]);const[loading,setLoading]=useState(true);const[beingNFT,setBeingNFT]=useState(true);const{t}=useTranslation();const currentAccount=localStorage.getItem(\"currentAccount\");const headers={'api-key':API_KEY};const initData=async()=>{try{const response=await axios.get(\"\".concat(website,\"/api/nftDetail/isFavorited\"),{headers:headers,params:{currentAccount:currentAccount}});let collectNFT=response.data;if(typeof collectNFT!=='undefined'&&typeof collectNFT.length==='undefined'||collectNFT.length===0){setBeingNFT(false);}else{const fetchImage=async data=>{const conditionMet=data.status===true||data.status===false&&data.forSale===1;if(conditionMet){const nftImgResponse=await axios.get(\"\".concat(website,\"/api/nftIMG/\").concat(data.comic_id,\"/\").concat(data.tokenId),{responseType:'blob',headers});data.image=nftImgResponse.data.type==='image/jpeg'?URL.createObjectURL(nftImgResponse.data):URL.createObjectURL(await(await axios.get(data.protoFilename===1?\"\".concat(website,\"/api/coverFile/\").concat(data.comic_id):\"\".concat(website,\"/api/comicIMG/\").concat(data.comic_id),{responseType:'blob',headers})).data);data.names=parseAuthorizations(data.description).map(auth=>auth.name);data.price=data.status?t('已擁有'):\"$ \".concat(Object.values(data.price).pop());return data;}return null;};const validNFTs=(await Promise.all(collectNFT.filter(data=>data.status===true||data.status===false&&data.forSale===1).map(fetchImage))).filter(result=>result!==null);//console.log(validNFTs);\nsetNFT(validNFTs);}setLoading(false);}catch(error){console.error('Error fetching records:',error);}};useEffect(()=>{initData();},[currentAccount]);const parseAuthorizations=text=>{text=text.trim();const lines=text.includes('\\n')?text.split('\\n'):[text];return lines.map(line=>{const[name]=line.split(':');return{name:t(name.trim())};});};const renderTooltip=(title,names)=>props=>/*#__PURE__*/_jsxs(Tooltip,{id:\"button-tooltip\",...props,children:[title,/*#__PURE__*/_jsx(\"hr\",{}),names.map((name,index)=>/*#__PURE__*/_jsx(\"div\",{children:name},index))]});return/*#__PURE__*/_jsx(_Fragment,{children:!loading?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Container,{className:\"creatorNft\",children:[/*#__PURE__*/_jsx(Row,{className:\"pt-5\",children:/*#__PURE__*/_jsx(\"h3\",{className:\"fw-bold\",children:t('已收藏NFT')})}),!beingNFT&&/*#__PURE__*/_jsx(Row,{className:\"pt-5 justify-content-center\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"fw-bold text-center\",children:t('目前尚未收藏NFT')})}),/*#__PURE__*/_jsx(Row,{className:\"pt-1 pb-5\",children:NFT.map((data,index)=>/*#__PURE__*/_jsx(Col,{xs:4,md:3,className:\"pt-3\",children:/*#__PURE__*/_jsx(Link,{to:\"/nftDetail/tokenId\".concat(data.tokenId),children:/*#__PURE__*/_jsx(Card,{className:\"effect-image-1\",children:/*#__PURE__*/_jsx(OverlayTrigger,{placement:\"top\",overlay:renderTooltip(data.title,data.names),children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:data.image,alt:\"image-\".concat(index+1)}),/*#__PURE__*/_jsx(\"div\",{className:\"collectionNft-overlay\",children:/*#__PURE__*/_jsx(\"span\",{children:data.price})}),/*#__PURE__*/_jsx(Card.Body,{className:\"simple-text\",children:/*#__PURE__*/_jsx(Card.Text,{className:\"creatorNft-text\",children:data.tokenTitle})})]})})})})},index))})]})}):/*#__PURE__*/_jsx(\"div\",{className:\"loading-container\",children:/*#__PURE__*/_jsx(\"div\",{children:t('頁面加載中')})})});}export default CollectionNft;","map":{"version":3,"names":["React","useState","useEffect","Container","Card","Col","Row","Pagination","OverlayTrigger","Tooltip","Link","useTranslation","i18n","axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","website","process","env","REACT_APP_Website","API_KEY","REACT_APP_API_KEY","CollectionNft","NFT","setNFT","loading","setLoading","beingNFT","setBeingNFT","t","currentAccount","localStorage","getItem","headers","initData","response","get","concat","params","collectNFT","data","length","fetchImage","conditionMet","status","forSale","nftImgResponse","comic_id","tokenId","responseType","image","type","URL","createObjectURL","protoFilename","names","parseAuthorizations","description","map","auth","name","price","Object","values","pop","validNFTs","Promise","all","filter","result","error","console","text","trim","lines","includes","split","line","renderTooltip","title","props","id","children","index","className","xs","md","to","placement","overlay","Img","variant","src","alt","Body","Text","tokenTitle"],"sources":["C:/Users/user1/Desktop/blockchain-comics-platform/frontend/src/routes/collectionNft.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Container, Card, Col, Row, Pagination, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport './bootstrap.min.css';\r\nimport { Link } from \"react-router-dom\";\r\nimport { useTranslation } from 'react-i18next';\r\nimport i18n from '../i18n';\r\nimport axios from 'axios';\r\nconst website = process.env.REACT_APP_Website;\r\nconst API_KEY = process.env.REACT_APP_API_KEY;\r\n\r\nfunction CollectionNft() {\r\n    const [NFT, setNFT] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [beingNFT, setBeingNFT] = useState(true);\r\n    const { t } = useTranslation();\r\n    const currentAccount = localStorage.getItem(\"currentAccount\");\r\n    const headers = {'api-key': API_KEY};\r\n\r\n    const initData = async () => {\r\n        try {\r\n            const response = await axios.get(`${website}/api/nftDetail/isFavorited`, {\r\n                headers: headers,\r\n                params: {\r\n                    currentAccount: currentAccount,\r\n                }\r\n            });\r\n            let collectNFT = response.data;\r\n            if (typeof collectNFT !== 'undefined' && typeof collectNFT.length === 'undefined' || collectNFT.length === 0) {\r\n                setBeingNFT(false);\r\n            } else {\r\n                const fetchImage = async (data) => {\r\n                    const conditionMet = data.status === true || (data.status === false && data.forSale === 1);\r\n                    if (conditionMet) {\r\n                        const nftImgResponse = await axios.get(`${website}/api/nftIMG/${data.comic_id}/${data.tokenId}`, {\r\n                            responseType: 'blob',\r\n                            headers,\r\n                        });\r\n                        data.image = nftImgResponse.data.type === 'image/jpeg'\r\n                            ? URL.createObjectURL(nftImgResponse.data)\r\n                            : URL.createObjectURL(\r\n                                await (await axios.get(\r\n                                    data.protoFilename === 1\r\n                                        ? `${website}/api/coverFile/${data.comic_id}`\r\n                                        : `${website}/api/comicIMG/${data.comic_id}`,\r\n                                    { responseType: 'blob', headers }\r\n                                )).data\r\n                            );\r\n                        data.names = parseAuthorizations(data.description).map(auth => auth.name);\r\n                        data.price = data.status ? t('已擁有') : `$ ${Object.values(data.price).pop()}`;\r\n                        return data;\r\n                    }\r\n                    return null;\r\n                };\r\n                const validNFTs = (await Promise.all(collectNFT\r\n                    .filter(data => data.status === true || (data.status === false && data.forSale === 1))\r\n                    .map(fetchImage))\r\n                ).filter(result => result !== null);\r\n                //console.log(validNFTs);\r\n                setNFT(validNFTs);\r\n            }\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Error fetching records:', error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        initData();\r\n    }, [currentAccount]);\r\n\r\n    const parseAuthorizations = (text) => {\r\n        text = text.trim();\r\n        const lines = text.includes('\\n') ? text.split('\\n') : [text];\r\n        return lines.map(line => {\r\n            const [name] = line.split(':');\r\n            return {\r\n                name: t(name.trim()),\r\n            };\r\n        });\r\n    };\r\n\r\n    const renderTooltip = (title, names) => (props) => (\r\n        <Tooltip id=\"button-tooltip\" {...props}>\r\n            {title}\r\n            <hr />\r\n            {names.map((name, index) => (\r\n                <div key={index}>{name}</div>\r\n            ))}\r\n        </Tooltip>\r\n    );\r\n\r\n\r\n    return (\r\n        <>\r\n            {!loading ? (\r\n                <>\r\n                <Container className='creatorNft'>\r\n                    <Row className='pt-5'>\r\n                        <h3 className=\"fw-bold\">{t('已收藏NFT')}</h3>\r\n                    </Row>\r\n                    {!beingNFT &&  \r\n                        <Row className='pt-5 justify-content-center'>\r\n                            <h1 className=\"fw-bold text-center\">{t('目前尚未收藏NFT')}</h1>\r\n                        </Row>\r\n                    }\r\n                    <Row className='pt-1 pb-5'>\r\n                        {NFT.map((data, index) => (\r\n                            <Col xs={4} md={3} className=\"pt-3\" key={index}>\r\n                                <Link to={`/nftDetail/tokenId${data.tokenId}`}>\r\n                                    <Card className=\"effect-image-1\">\r\n                                        <OverlayTrigger placement=\"top\" overlay={renderTooltip(data.title, data.names)}>\r\n                                            <div>\r\n                                                <Card.Img variant=\"top\" src={data.image} alt={`image-${index + 1}`} />\r\n                                                <div className=\"collectionNft-overlay\">\r\n                                                    <span>{data.price}</span>\r\n                                                </div>\r\n                                                <Card.Body className=\"simple-text\">\r\n                                                    <Card.Text className=\"creatorNft-text\">{data.tokenTitle}</Card.Text>\r\n                                                </Card.Body>\r\n                                            </div>\r\n                                        </OverlayTrigger>\r\n                                    </Card>\r\n                                </Link>\r\n                            </Col>\r\n                        ))}\r\n                    </Row>\r\n                </Container>\r\n                </>\r\n            ) : (\r\n                <div className=\"loading-container\">\r\n                    <div>{t('頁面加載中')}</div>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default CollectionNft;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}