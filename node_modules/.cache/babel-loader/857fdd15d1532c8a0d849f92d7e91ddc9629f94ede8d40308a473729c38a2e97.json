{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link,useParams}from\"react-router-dom\";import{Container,Card,Col,Row,Button,Table,ButtonToolbar,Pagination,Tooltip,OverlayTrigger}from'react-bootstrap';import'./bootstrap.min.css';import{Heart,HeartFill,CardImage}from'react-bootstrap-icons';import{message}from'antd';import comicData from'../contracts/ComicPlatform.json';import{useTranslation}from'react-i18next';import i18n from'../i18n';import axios from'axios';import{sortByTimestamp,getTransactionTimestamp,formatDate,disableAllButtons,enableAllButtons,initializeWeb3}from'../index';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const website=process.env.REACT_APP_Website;const API_KEY=process.env.REACT_APP_API_KEY;function ComicDetail(){const[comic,setComic]=useState([]);const[similComic,setSimilComic]=useState([]);const[chapters,setChapters]=useState([]);const{comicID}=useParams();const[loading,setLoading]=useState(true);const[isFavorited,setIsFavorited]=useState('');const[currentPage,setCurrentPage]=useState(1);const[piracy,setPiracy]=useState([]);const{t}=useTranslation();const storedArrayJSON=localStorage.getItem('comicDatas');const currentAccount=localStorage.getItem(\"currentAccount\");const headers={'api-key':API_KEY};const fetchedData=[];const buttonData=[t('開始閱讀'),t('收藏')];let temp=[];let chapterInfo=[];const initData=async()=>{try{const storedArray=JSON.parse(storedArrayJSON);for(let i=0;i<storedArray.length;i++){if(storedArray[i].is_exist===0){if(storedArray[i].comicID===comicID){const comicHash=storedArray[i].comic_id;let protoFilename;if(storedArray[i].protoFilename){const protoResponse=await axios.get(\"\".concat(website,\"/api/coverFile/\").concat(comicHash),{responseType:'blob',headers});protoFilename=URL.createObjectURL(protoResponse.data);}else{const imageResponse=await axios.get(\"\".concat(website,\"/api/comicIMG/\").concat(comicHash),{responseType:'blob',headers});protoFilename=URL.createObjectURL(imageResponse.data);}let author;if(storedArray[i].creator==currentAccount){author=t('您是本作品的創作者');}else{author=storedArray[i].creator;}temp.push({comicHash:comicHash,comicID:storedArray[i].comicID,title:storedArray[i].title,description:storedArray[i].description,author:author,penName:storedArray[i].penName,category:storedArray[i].category,protoFilename:protoFilename,release:storedArray[i].date});}}}if(temp.length!==0){//console.log(temp);\nsetComic(temp);for(let i=0;i<storedArray.length;i++){// 類似漫畫 依據類型跟同作者取前4本\nif((storedArray[i].category==temp[0].category||storedArray[i].creator==temp[0].author)&&storedArray[i].comicID!=comicID&&storedArray[i].is_exist===0){const imageResponse=await axios.get(\"\".concat(website,\"/api/comicIMG/\").concat(storedArray[i].comic_id),{responseType:'blob',headers});const image=URL.createObjectURL(imageResponse.data);fetchedData.push({comicID:storedArray[i].comicID,title:storedArray[i].title,description:storedArray[i].description,penName:storedArray[i].penName,category:storedArray[i].category,image:image,date:storedArray[i].date});}if(fetchedData.length==4){break;}}setSimilComic(fetchedData);// 章節購買者\ntry{const response=await axios.get(\"\".concat(website,\"/api/comicDetail\"),{headers:headers,params:{comicHash:temp[0].comicHash,currentAccount:currentAccount}});let chapters=response.data;sortByTimestamp(chapters);//console.log(chapters);\nchapters=chapters.map((chapter,index)=>{let isBuying,price;if(chapter.creator===currentAccount||chapter.isBuying!==null||chapter.price==0){isBuying=t('閱讀');price=chapter.price==0?t('免費'):chapter.price;}else{isBuying=t('購買');price=chapter.price;}return{...chapter,chapterID:\"chapter\".concat(index+1),isBuying,price};});//console.log(chapters);\nsetChapters(chapters);let lastChapterInfo=chapters[chapters.length-1];let updatedComic=temp.map(comic=>{return{...comic,chapter:lastChapterInfo.title,date:formatDate(new Date(Number(lastChapterInfo.create_timestamp)))};});//console.log(updatedComic);\nsetComic(updatedComic);}catch(error){console.error('Error fetching records:',error);}// 資料庫查詢收藏狀態\ntry{const response=await axios.get(\"\".concat(website,\"/api/comicDetail/isFavorited\"),{headers:headers,params:{currentAccount:currentAccount,comicHash:temp[0].comicHash}});//console.log(response.data.isFavorited);\nsetIsFavorited(response.data.isFavorited);}catch(error){console.error('Error fetching records:',error);}}else{const temp=storedArray.filter(item=>item.comicID===comicID).map(item=>({title:item.title,description:item.description,author:item.creator,penName:item.penName,state:item.is_exist===2?t('盜版漫畫，已下架，已退款'):t('漫畫查核中，暫不開放，敬請見諒')}));setComic(temp);}setLoading(false);}catch(error){console.error('Error initializing comic:',error);}};useEffect(()=>{initData();},[comicID]);const handleFavoriteClick=async()=>{const web3=await initializeWeb3(t);if(!web3){return;}const web3Instance=new web3.eth.Contract(comicData.abi,comicData.address);const accounts=await web3.eth.getAccounts();if(accounts[0]){setIsFavorited(!isFavorited);// 切換收藏狀態\ntry{const response=await axios.put(\"\".concat(website,\"/api/update/comicDetail/favorite\"),null,{headers:headers,params:{currentAccount:currentAccount,comicHash:comic[0].comicHash,bool:!isFavorited}});}catch(error){console.error('Error handleFavoriteClick',error);}}else{alert(t('請先登入以太坊錢包，才可以收藏'));return;}};const handleReadClick=async()=>{const reading=chapters.find(chapter=>chapter.isBuying===t('閱讀'));if(reading){const readingProgress=localStorage.getItem(\"readingProgress\");const readingArray=readingProgress?JSON.parse(readingProgress):{};const exists=chapters.some(chapter=>chapter.isBuying===t('閱讀')&&chapter.chapterID===readingArray[comicID]);if(comicID in readingArray&&exists===true&&reading.price!==t('免費')){// 有購買紀錄\nwindow.location.replace(\"/comicRead/\".concat(comicID,\"/\").concat(readingArray[comicID]));}else{// 免費閱讀\nwindow.location.replace(\"/comicRead/\".concat(comicID,\"/\").concat(reading.chapterID));}}else{message.info(\"\".concat(comic[0].title,\" \").concat(t('沒有提供免費試讀')));}};// 章節購買 或 閱讀函數\nconst handlePurchase=async chapterId=>{const chapter=currentChapters[chapterId];// 使用傳遞進來的索引值來訪問章節資料\nconst operationValue=chapter.isBuying;if(operationValue===t('閱讀')){window.location.href=\"/comicRead/\".concat(comicID,\"/\").concat(chapter.chapterID);}else{try{disableAllButtons();const web3=await initializeWeb3(t);if(!web3){return;}const web3Instance=new web3.eth.Contract(comicData.abi,comicData.address);const accounts=await web3.eth.getAccounts();const account=accounts[0];if(account){let balance=await web3.eth.getBalance(currentAccount);balance=balance.toString()/1e18;let price=chapter.price;if(balance>price){const comicHash=comic[0].comicHash;const chapterHash=chapter.chapterHash;//console.log(comicHash);\n//console.log(chapterHash);\n//console.log(price);\nprice=web3.utils.toWei(price,'ether');let gasEstimate=await web3Instance.methods.purchaseChapter(comicHash,chapterHash,price/10).estimateGas({from:currentAccount,value:price});const transaction=await web3Instance.methods.purchaseChapter(comicHash,chapterHash,gasEstimate).send({from:currentAccount,value:price,gas:gasEstimate});const transactionHash=transaction.transactionHash;let Timestamp=await getTransactionTimestamp(transactionHash);const formData=new FormData();formData.append('hash',transactionHash);formData.append('comic_id',comicHash);formData.append('chapter_id',chapterHash);formData.append('buyer',currentAccount);formData.append('purchase_date',Timestamp);formData.append('price',chapter.price);try{const response=await axios.post(\"\".concat(website,\"/api/add/records\"),formData,{headers:{'Content-Type':'multipart/form-data','api-key':API_KEY}});message.info(t('章節購買成功'));const updatedChapters=[...currentChapters];updatedChapters[chapterId].isBuying=t('閱讀');// 更新章節的購買狀態\nsetChapters(updatedChapters);}catch(error){console.error('購買紀錄添加至資料庫時發生錯誤：',error);}}else{message.info(t('餘額不足'));}}else{alert(t('請先登入以太坊錢包，再進行購買'));return;}}catch(error){if(error.message.includes('User denied transaction signature')){alert(t('拒绝交易'));}else{console.error('章節購買時發生錯誤：',error);alert(error);window.location.reload();}}finally{enableAllButtons();}}};const itemsPerPage=10;// 每頁顯示的章節數量\nconst totalPages=Math.ceil(chapters.length/itemsPerPage);const handlePageChange=page=>{setCurrentPage(page);};// 計算當前頁面的章節切片的起始索引\nconst startIndex=(currentPage-1)*itemsPerPage;const currentChapters=chapters.slice(startIndex,startIndex+itemsPerPage);const getPageItems=()=>{const pageItems=[];const maxPagesToShow=5;// 顯示的最大頁碼數量\nif(totalPages<=maxPagesToShow){// 如果總頁數小於等於最大顯示頁碼數，則顯示所有頁碼\nfor(let i=1;i<=totalPages;i++){pageItems.push(/*#__PURE__*/_jsx(Pagination.Item,{active:i===currentPage,onClick:()=>handlePageChange(i),children:i},i));}}else{// 計算中間的頁碼範圍\nconst middlePages=Math.floor(maxPagesToShow/2);let startPage=Math.max(2,currentPage-middlePages);let endPage=Math.min(totalPages-1,currentPage+middlePages);if(currentPage-startPage<=middlePages){endPage=Math.min(totalPages-1,startPage+maxPagesToShow-2);}if(endPage-currentPage<=middlePages){startPage=Math.max(2,endPage-maxPagesToShow+2);}// 第一頁\npageItems.push(/*#__PURE__*/_jsx(Pagination.Item,{active:currentPage===1,onClick:()=>handlePageChange(1),children:\"1\"},1));if(startPage>2){pageItems.push(/*#__PURE__*/_jsx(Pagination.Ellipsis,{},\"ellipsis-start\"));}// 中間的頁碼\nfor(let i=startPage;i<=endPage;i++){pageItems.push(/*#__PURE__*/_jsx(Pagination.Item,{active:i===currentPage,onClick:()=>handlePageChange(i),children:i},i));}if(endPage<totalPages-1){pageItems.push(/*#__PURE__*/_jsx(Pagination.Ellipsis,{},\"ellipsis-end\"));}// 最後一頁\npageItems.push(/*#__PURE__*/_jsx(Pagination.Item,{active:currentPage===totalPages,onClick:()=>handlePageChange(totalPages),children:totalPages},totalPages));}return pageItems;};const renderTooltip=description=>props=>/*#__PURE__*/_jsx(Tooltip,{id:\"button-tooltip\",...props,children:description});return/*#__PURE__*/_jsxs(_Fragment,{children:[!loading&&/*#__PURE__*/_jsxs(Container,{className:\"comicDetail\",children:[/*#__PURE__*/_jsx(Row,{className:\"pt-5\",children:/*#__PURE__*/_jsx(\"div\",{className:\"d-block mx-auto img-fluid carousel-image-container\",children:comic[0].state?/*#__PURE__*/_jsxs(\"div\",{className:\"remove-section\",style:{display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(\"img\",{src:\"/piratyPromo.jpg\"}),/*#__PURE__*/_jsx(\"div\",{id:\"notimage\",className:\"hidden\",children:t(comic[0].state)})]}):/*#__PURE__*/_jsx(\"img\",{className:\"d-block mx-auto img-fluid\",src:comic[0].protoFilename,alt:\"800x400\"})})}),/*#__PURE__*/_jsx(Row,{className:\"pt-3 pb-3 btn-container justify-content-center\",children:buttonData.map((label,idx)=>/*#__PURE__*/_jsx(Col,{xs:2,md:2,lg:2,className:\"pb-3 btn-section d-flex justify-content-center\",children:/*#__PURE__*/_jsxs(Button,{variant:\"outline-dark\",className:\"custom-button\",onClick:label===t('收藏')?handleFavoriteClick:handleReadClick,\"data-backgroundcolor\":\"#fff\",disabled:comic[0].state?true:false,children:[label===t('收藏')&&/*#__PURE__*/_jsx(_Fragment,{children:isFavorited?/*#__PURE__*/_jsx(HeartFill,{className:\"me-2\",style:{color:'#F6B93B',cursor:'pointer'},size:20}):/*#__PURE__*/_jsx(Heart,{className:\"me-2\",style:{color:'black',cursor:'pointer'},size:20})}),label]})},idx))}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(Col,{className:\"text-section\",children:comic.map((comic,index)=>/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"fw-bold \".concat(comic.state&&'delete-line'),children:comic.title}),comic.state?/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"comicDetail-penName delete-line\",children:comic.penName}),/*#__PURE__*/_jsxs(\"span\",{className:\"address delete-line\",children:[\"(\",comic.author,\")\"]})]}):/*#__PURE__*/_jsx(Link,{to:\"/authorProfile/\".concat(comic.author===t('您是本作品的創作者')?currentAccount:comic.author),children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"comicDetail-penName\",children:comic.penName}),/*#__PURE__*/_jsxs(\"span\",{className:\"address\",children:[\"(\",comic.author,\")\"]})]})}),/*#__PURE__*/_jsxs(\"p\",{children:[t('發布日期'),\"\\uFF1A\",comic.release]}),/*#__PURE__*/_jsxs(\"p\",{children:[t('最新章節'),\"\\uFF1A\",comic.chapter,/*#__PURE__*/_jsxs(\"span\",{className:\"text-secondary\",children:[\"...\",comic.date]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-secondary \".concat(comic.state&&'delete-line'),children:comic.description})]},index))})}),/*#__PURE__*/_jsx(Row,{className:\"pt-5 chapter-title-section\",children:/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"fw-bold mb-0\",children:t('章節目錄')}),/*#__PURE__*/_jsx(\"p\",{className:\"text-end mb-0\",children:t('查看全部章節')})]}),/*#__PURE__*/_jsx(\"hr\",{})]})}),/*#__PURE__*/_jsx(Row,{className:\"justify-content-center\",children:/*#__PURE__*/_jsx(Col,{className:\"d-flex justify-content-center chapter-table\",children:/*#__PURE__*/_jsx(Table,{size:\"sm\",children:/*#__PURE__*/_jsx(\"tbody\",{children:currentChapters.map((chapter,index)=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"text-center fw-bold\",children:t('第幾章',{chapter:startIndex+index+1})}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:chapter.title}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:chapter.price}),/*#__PURE__*/_jsx(\"td\",{className:\"text-center\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePurchase(index),className:\"btn \".concat(chapter.isBuying===t('閱讀')?'read-button':'buy-button'),value:chapter.isBuying,children:chapter.isBuying})})]},index))})})})}),/*#__PURE__*/_jsx(Row,{className:\"pt-2 pb-5 justify-content-center table-button\",children:/*#__PURE__*/_jsx(Col,{className:\"d-flex justify-content-center\",children:/*#__PURE__*/_jsx(ButtonToolbar,{\"aria-label\":\"Toolbar with pagination\",children:/*#__PURE__*/_jsxs(Pagination,{children:[/*#__PURE__*/_jsx(Pagination.Prev,{onClick:()=>handlePageChange(currentPage-1),disabled:currentPage<=1,className:\"pagination-button\"}),getPageItems(),/*#__PURE__*/_jsx(Pagination.Next,{onClick:()=>handlePageChange(currentPage+1),disabled:currentPage>=totalPages,className:\"pagination-button\"})]})})})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsx(\"h3\",{className:\"fw-bold\",children:t('類似漫畫')})}),/*#__PURE__*/_jsx(Row,{xs:1,md:2,className:\"g-4 pb-5\",children:similComic.map((data,idx)=>/*#__PURE__*/_jsx(Col,{xs:6,md:3,className:\"pt-3\",children:/*#__PURE__*/_jsx(Link,{to:\"/comicDetail/\".concat(data.comicID),children:/*#__PURE__*/_jsxs(Card,{className:\"ranking-thumbnail-position\",children:[/*#__PURE__*/_jsx(OverlayTrigger,{placement:\"top\",overlay:renderTooltip(data.description),children:/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:data.image})}),/*#__PURE__*/_jsx(\"div\",{className:\"comicDetail-createTime\",style:{marginBottom:\"0px\"},children:data.penName}),/*#__PURE__*/_jsx(\"div\",{className:\"comicDetail-createTime\",children:data.date}),/*#__PURE__*/_jsxs(Card.Body,{children:[/*#__PURE__*/_jsx(Card.Title,{className:\"text-center\",children:data.title}),/*#__PURE__*/_jsx(Card.Text,{className:\"comicDetail-text\",children:data.description})]})]})})},idx))})]}),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"loading-container\",children:/*#__PURE__*/_jsx(\"div\",{children:t('頁面加載中')})})]});}export default ComicDetail;","map":{"version":3,"names":["React","useState","useEffect","Link","useParams","Container","Card","Col","Row","Button","Table","ButtonToolbar","Pagination","Tooltip","OverlayTrigger","Heart","HeartFill","CardImage","message","comicData","useTranslation","i18n","axios","sortByTimestamp","getTransactionTimestamp","formatDate","disableAllButtons","enableAllButtons","initializeWeb3","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","website","process","env","REACT_APP_Website","API_KEY","REACT_APP_API_KEY","ComicDetail","comic","setComic","similComic","setSimilComic","chapters","setChapters","comicID","loading","setLoading","isFavorited","setIsFavorited","currentPage","setCurrentPage","piracy","setPiracy","t","storedArrayJSON","localStorage","getItem","currentAccount","headers","fetchedData","buttonData","temp","chapterInfo","initData","storedArray","JSON","parse","i","length","is_exist","comicHash","comic_id","protoFilename","protoResponse","get","concat","responseType","URL","createObjectURL","data","imageResponse","author","creator","push","title","description","penName","category","release","date","image","response","params","map","chapter","index","isBuying","price","chapterID","lastChapterInfo","updatedComic","Date","Number","create_timestamp","error","console","filter","item","state","handleFavoriteClick","web3","web3Instance","eth","Contract","abi","address","accounts","getAccounts","put","bool","alert","handleReadClick","reading","find","readingProgress","readingArray","exists","some","window","location","replace","info","handlePurchase","chapterId","currentChapters","operationValue","href","account","balance","getBalance","toString","chapterHash","utils","toWei","gasEstimate","methods","purchaseChapter","estimateGas","from","value","transaction","send","gas","transactionHash","Timestamp","formData","FormData","append","post","updatedChapters","includes","reload","itemsPerPage","totalPages","Math","ceil","handlePageChange","page","startIndex","slice","getPageItems","pageItems","maxPagesToShow","Item","active","onClick","children","middlePages","floor","startPage","max","endPage","min","Ellipsis","renderTooltip","props","id","className","style","display","flexDirection","src","alt","label","idx","xs","md","lg","variant","disabled","color","cursor","size","to","Prev","Next","placement","overlay","Img","marginBottom","Body","Title","Text"],"sources":["C:/Users/user1/Desktop/blockchain-comics-platform/frontend/src/routes/comicDetail.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Link, useParams } from \"react-router-dom\";\r\nimport { Container, Card, Col, Row, Button, Table, ButtonToolbar, Pagination, Tooltip, OverlayTrigger } from 'react-bootstrap';\r\nimport './bootstrap.min.css';\r\nimport { Heart, HeartFill, CardImage } from 'react-bootstrap-icons';\r\nimport { message } from 'antd';\r\nimport comicData from '../contracts/ComicPlatform.json';\r\nimport { useTranslation } from 'react-i18next';\r\nimport i18n from '../i18n';\r\nimport axios from 'axios';\r\nimport { sortByTimestamp, getTransactionTimestamp, formatDate, disableAllButtons, enableAllButtons, initializeWeb3 } from '../index';\r\nconst website = process.env.REACT_APP_Website;\r\nconst API_KEY = process.env.REACT_APP_API_KEY;\r\n\r\nfunction ComicDetail() {\r\n    const [comic, setComic] = useState([]);\r\n    const [similComic, setSimilComic] = useState([]);\r\n    const [chapters, setChapters] = useState([]);\r\n    const { comicID } = useParams();\r\n    const [loading, setLoading] = useState(true);\r\n    const [isFavorited, setIsFavorited] = useState('');\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const [piracy, setPiracy] = useState([]);\r\n    const { t } = useTranslation();\r\n    const storedArrayJSON = localStorage.getItem('comicDatas');\r\n    const currentAccount = localStorage.getItem(\"currentAccount\");\r\n    const headers = {'api-key': API_KEY};\r\n    const fetchedData = [];\r\n    const buttonData = [\r\n        t('開始閱讀'), t('收藏')\r\n    ];\r\n    let temp = [];\r\n    let chapterInfo = [];\r\n\r\n    const initData = async () => {\r\n        try {\r\n            const storedArray = JSON.parse(storedArrayJSON);\r\n            for (let i = 0; i < storedArray.length; i++) {\r\n                if (storedArray[i].is_exist === 0) {\r\n                    if (storedArray[i].comicID === comicID) {\r\n                        const comicHash = storedArray[i].comic_id;\r\n                        \r\n                        let protoFilename;\r\n                        if (storedArray[i].protoFilename) {\r\n                            const protoResponse = await axios.get(`${website}/api/coverFile/${comicHash}`, { responseType: 'blob', headers });\r\n                            protoFilename = URL.createObjectURL(protoResponse.data); \r\n                        } else {\r\n                            const imageResponse = await axios.get(`${website}/api/comicIMG/${comicHash}`, { responseType: 'blob', headers });\r\n                            protoFilename = URL.createObjectURL(imageResponse.data);\r\n                        }\r\n                        let author;\r\n                        if (storedArray[i].creator == currentAccount) {\r\n                            author = t('您是本作品的創作者');\r\n                        } else {\r\n                            author = storedArray[i].creator;\r\n                        }\r\n                        temp.push({\r\n                            comicHash: comicHash,\r\n                            comicID: storedArray[i].comicID,\r\n                            title: storedArray[i].title,\r\n                            description: storedArray[i].description,\r\n                            author: author,\r\n                            penName: storedArray[i].penName,\r\n                            category: storedArray[i].category,\r\n                            protoFilename: protoFilename,\r\n                            release: storedArray[i].date\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            if (temp.length !== 0){\r\n                //console.log(temp);\r\n                setComic(temp);\r\n\r\n                for (let i = 0; i < storedArray.length; i++) {\r\n                    // 類似漫畫 依據類型跟同作者取前4本\r\n                    if ((storedArray[i].category == temp[0].category || storedArray[i].creator == temp[0].author) && storedArray[i].comicID != comicID && storedArray[i].is_exist === 0) {\r\n                        const imageResponse = await axios.get(`${website}/api/comicIMG/${storedArray[i].comic_id}`, { responseType: 'blob', headers });\r\n                        const image = URL.createObjectURL(imageResponse.data);\r\n                        fetchedData.push({\r\n                            comicID: storedArray[i].comicID,\r\n                            title: storedArray[i].title,\r\n                            description: storedArray[i].description,\r\n                            penName: storedArray[i].penName,\r\n                            category: storedArray[i].category,\r\n                            image: image,\r\n                            date: storedArray[i].date\r\n                        });\r\n                    }\r\n                    if (fetchedData.length == 4) {\r\n                        break;\r\n                    }\r\n                }\r\n                setSimilComic(fetchedData);\r\n    \r\n                // 章節購買者\r\n                try {\r\n                    const response = await axios.get(`${website}/api/comicDetail`, {\r\n                        headers: headers,\r\n                        params: {\r\n                            comicHash: temp[0].comicHash,\r\n                            currentAccount: currentAccount\r\n                        }\r\n                    });\r\n                    let chapters = response.data;\r\n                    sortByTimestamp(chapters);\r\n                    //console.log(chapters);\r\n    \r\n                    chapters = chapters.map((chapter, index) => {\r\n                        let isBuying, price;\r\n                        if (chapter.creator === currentAccount || chapter.isBuying !== null || chapter.price == 0) {\r\n                            isBuying = t('閱讀');\r\n                            price = chapter.price == 0 ? t('免費') : chapter.price;\r\n                        } else {\r\n                            isBuying = t('購買');\r\n                            price = chapter.price;\r\n                        }\r\n                        return {\r\n                            ...chapter,\r\n                            chapterID: `chapter${index + 1}`,\r\n                            isBuying,\r\n                            price\r\n                        };\r\n                    });\r\n                    //console.log(chapters);\r\n                    setChapters(chapters);\r\n    \r\n                    let lastChapterInfo = chapters[chapters.length - 1];\r\n                    let updatedComic = temp.map(comic => {\r\n                        return {...comic, chapter: lastChapterInfo.title, date: formatDate(new Date(Number(lastChapterInfo.create_timestamp)))};\r\n                    });\r\n                    //console.log(updatedComic);\r\n                    setComic(updatedComic);\r\n                } catch (error) {\r\n                    console.error('Error fetching records:', error);\r\n                }\r\n    \r\n                // 資料庫查詢收藏狀態\r\n                try {\r\n                    const response = await axios.get(`${website}/api/comicDetail/isFavorited`, {\r\n                        headers: headers,\r\n                        params: {\r\n                            currentAccount: currentAccount,\r\n                            comicHash: temp[0].comicHash\r\n                        }\r\n                    });\r\n                    //console.log(response.data.isFavorited);\r\n                    setIsFavorited(response.data.isFavorited);\r\n                } catch (error) {\r\n                    console.error('Error fetching records:', error);\r\n                }\r\n            } else {\r\n                const temp = storedArray\r\n                    .filter(item => item.comicID === comicID)\r\n                    .map(item => ({\r\n                    title: item.title,\r\n                    description: item.description,\r\n                    author: item.creator,\r\n                    penName: item.penName,\r\n                    state: item.is_exist === 2 ? t('盜版漫畫，已下架，已退款') : t('漫畫查核中，暫不開放，敬請見諒')\r\n                    }));\r\n                setComic(temp);\r\n            }\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Error initializing comic:', error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        initData();\r\n    }, [comicID]);\r\n\r\n    const handleFavoriteClick = async () => {\r\n        const web3 = await initializeWeb3(t);\r\n        if (!web3) {\r\n            return;\r\n        }\r\n        const web3Instance = new web3.eth.Contract(comicData.abi, comicData.address);\r\n        const accounts = await web3.eth.getAccounts();\r\n        if (accounts[0]) {\r\n            setIsFavorited(!isFavorited); // 切換收藏狀態\r\n            try {\r\n                const response = await axios.put(`${website}/api/update/comicDetail/favorite`, null, {\r\n                    headers: headers,\r\n                    params: {\r\n                        currentAccount: currentAccount,\r\n                        comicHash: comic[0].comicHash,\r\n                        bool: !isFavorited,\r\n                    },\r\n                });\r\n            } catch (error) {\r\n                console.error('Error handleFavoriteClick', error);\r\n            }\r\n        } else {\r\n            alert(t('請先登入以太坊錢包，才可以收藏'));\r\n            return;\r\n        }\r\n    };\r\n\r\n    const handleReadClick = async () => {\r\n        const reading = chapters.find(chapter => chapter.isBuying === t('閱讀'));\r\n        if (reading) {\r\n            const readingProgress = localStorage.getItem(\"readingProgress\");\r\n            const readingArray = readingProgress ? JSON.parse(readingProgress) : {};\r\n            const exists = chapters.some(chapter => chapter.isBuying === t('閱讀') && chapter.chapterID === readingArray[comicID]);\r\n            if (comicID in readingArray && exists === true && reading.price !== t('免費')) {  // 有購買紀錄\r\n                window.location.replace(`/comicRead/${comicID}/${readingArray[comicID]}`);\r\n            } else {  // 免費閱讀\r\n                window.location.replace(`/comicRead/${comicID}/${reading.chapterID}`);\r\n            }\r\n        } else {\r\n            message.info(`${comic[0].title} ${t('沒有提供免費試讀')}`);\r\n        }\r\n    };\r\n\r\n    // 章節購買 或 閱讀函數\r\n    const handlePurchase = async (chapterId) => {\r\n        const chapter = currentChapters[chapterId]; // 使用傳遞進來的索引值來訪問章節資料\r\n        const operationValue = chapter.isBuying;\r\n\r\n        if (operationValue === t('閱讀')) {\r\n        window.location.href = `/comicRead/${comicID}/${chapter.chapterID}`;\r\n        } else {\r\n        try {\r\n            disableAllButtons();\r\n            const web3 = await initializeWeb3(t);\r\n            if (!web3) {\r\n                return;\r\n            }\r\n            const web3Instance = new web3.eth.Contract(comicData.abi, comicData.address);\r\n            const accounts = await web3.eth.getAccounts();\r\n            const account = accounts[0];\r\n            if (account) {\r\n                let balance = await web3.eth.getBalance(currentAccount);\r\n                balance = balance.toString() / 1e18;\r\n                let price = chapter.price;\r\n                if (balance > price) {\r\n                    const comicHash = comic[0].comicHash;\r\n                    const chapterHash = chapter.chapterHash;\r\n                    //console.log(comicHash);\r\n                    //console.log(chapterHash);\r\n                    //console.log(price);\r\n                    price = web3.utils.toWei(price, 'ether');\r\n    \r\n                    let gasEstimate = await web3Instance.methods.purchaseChapter(comicHash, chapterHash, price/10).estimateGas({\r\n                        from: currentAccount,\r\n                        value: price,\r\n                    });\r\n                    const transaction = await web3Instance.methods.purchaseChapter(comicHash, chapterHash, gasEstimate).send({\r\n                        from: currentAccount,\r\n                        value: price,\r\n                        gas: gasEstimate\r\n                    });\r\n                    const transactionHash = transaction.transactionHash;\r\n                    let Timestamp = await getTransactionTimestamp(transactionHash);\r\n    \r\n                    const formData = new FormData();\r\n                    formData.append('hash', transactionHash);\r\n                    formData.append('comic_id', comicHash);\r\n                    formData.append('chapter_id', chapterHash);\r\n                    formData.append('buyer', currentAccount);\r\n                    formData.append('purchase_date', Timestamp);\r\n                    formData.append('price', chapter.price);\r\n                    try {\r\n                        const response = await axios.post(`${website}/api/add/records`, formData, {\r\n                        headers: {\r\n                            'Content-Type': 'multipart/form-data',\r\n                            'api-key': API_KEY\r\n                        }\r\n                        });\r\n                        message.info(t('章節購買成功'));\r\n                        const updatedChapters = [...currentChapters];\r\n                        updatedChapters[chapterId].isBuying = t('閱讀'); // 更新章節的購買狀態\r\n                        setChapters(updatedChapters);\r\n                    } catch (error) {\r\n                        console.error('購買紀錄添加至資料庫時發生錯誤：', error);\r\n                    }\r\n                } else {\r\n                    message.info(t('餘額不足'));\r\n                }\r\n            } else {\r\n                alert(t('請先登入以太坊錢包，再進行購買'));\r\n                return;\r\n            }\r\n        } catch (error) {\r\n            if (error.message.includes('User denied transaction signature')) {\r\n                alert(t('拒绝交易'));\r\n                } else {\r\n                console.error('章節購買時發生錯誤：', error);\r\n                alert(error);\r\n                window.location.reload();\r\n                }\r\n        } finally {\r\n            enableAllButtons();\r\n        }\r\n        }\r\n    };\r\n\r\n    const itemsPerPage = 10; // 每頁顯示的章節數量\r\n    const totalPages = Math.ceil(chapters.length / itemsPerPage);\r\n\r\n    const handlePageChange = (page) => {\r\n        setCurrentPage(page);\r\n    };\r\n\r\n    // 計算當前頁面的章節切片的起始索引\r\n    const startIndex = (currentPage - 1) * itemsPerPage;\r\n    const currentChapters = chapters.slice(startIndex, startIndex + itemsPerPage);\r\n\r\n    const getPageItems = () => {\r\n        const pageItems = [];\r\n        const maxPagesToShow = 5; // 顯示的最大頁碼數量\r\n    \r\n        if (totalPages <= maxPagesToShow) {\r\n            // 如果總頁數小於等於最大顯示頁碼數，則顯示所有頁碼\r\n            for (let i = 1; i <= totalPages; i++) {\r\n                pageItems.push(\r\n                    <Pagination.Item key={i} active={i === currentPage} onClick={() => handlePageChange(i)}>\r\n                        {i}\r\n                    </Pagination.Item>\r\n                );\r\n            }\r\n        } else {\r\n            // 計算中間的頁碼範圍\r\n            const middlePages = Math.floor(maxPagesToShow / 2);\r\n            let startPage = Math.max(2, currentPage - middlePages);\r\n            let endPage = Math.min(totalPages - 1, currentPage + middlePages);\r\n    \r\n            if (currentPage - startPage <= middlePages) {\r\n                endPage = Math.min(totalPages - 1, startPage + maxPagesToShow - 2);\r\n            }\r\n    \r\n            if (endPage - currentPage <= middlePages) {\r\n                startPage = Math.max(2, endPage - maxPagesToShow + 2);\r\n            }\r\n    \r\n            // 第一頁\r\n            pageItems.push(\r\n                <Pagination.Item key={1} active={currentPage === 1} onClick={() => handlePageChange(1)}>\r\n                    1\r\n                </Pagination.Item>\r\n            );\r\n    \r\n            if (startPage > 2) {\r\n                pageItems.push(<Pagination.Ellipsis key=\"ellipsis-start\" />);\r\n            }\r\n    \r\n            // 中間的頁碼\r\n            for (let i = startPage; i <= endPage; i++) {\r\n                pageItems.push(\r\n                    <Pagination.Item key={i} active={i === currentPage} onClick={() => handlePageChange(i)}>\r\n                        {i}\r\n                    </Pagination.Item>\r\n                );\r\n            }\r\n    \r\n            if (endPage < totalPages - 1) {\r\n                pageItems.push(<Pagination.Ellipsis key=\"ellipsis-end\" />);\r\n            }\r\n    \r\n            // 最後一頁\r\n            pageItems.push(\r\n                <Pagination.Item key={totalPages} active={currentPage === totalPages} onClick={() => handlePageChange(totalPages)}>\r\n                    {totalPages}\r\n                </Pagination.Item>\r\n            );\r\n        }\r\n    \r\n        return pageItems;\r\n    };\r\n\r\n    const renderTooltip = (description) => (props) => (\r\n        <Tooltip id=\"button-tooltip\" {...props}>\r\n            {description}\r\n        </Tooltip>\r\n    );\r\n\r\n\r\n    return (\r\n        <>\r\n            {!loading && (\r\n                <Container className='comicDetail'>\r\n                    <Row className=\"pt-5\">\r\n                        <div className=\"d-block mx-auto img-fluid carousel-image-container\">\r\n                            {comic[0].state ? (\r\n                                <div className='remove-section' style={{ display: 'flex', flexDirection: 'column' }}>\r\n                                    {/* <div id=\"start\" style={{ display: 'block'}}> */}\r\n                                        <img src='/piratyPromo.jpg' />\r\n                                        <div id=\"notimage\" className=\"hidden\">{t(comic[0].state)}</div>\r\n                                    {/* </div> */}\r\n                                </div>\r\n                            ) : (\r\n                                <img\r\n                                    className=\"d-block mx-auto img-fluid\"\r\n                                    src={comic[0].protoFilename}\r\n                                    alt=\"800x400\"\r\n                                />\r\n                            )}\r\n                        </div>\r\n                    </Row>\r\n                    <Row className=\"pt-3 pb-3 btn-container justify-content-center\">\r\n                        {buttonData.map((label, idx) => (\r\n                            <Col key={idx} xs={2} md={2} lg={2} className=\"pb-3 btn-section d-flex justify-content-center\">\r\n                                <Button \r\n                                    variant=\"outline-dark\"\r\n                                    className=\"custom-button\"\r\n                                    onClick={label === t('收藏') ? handleFavoriteClick : handleReadClick}\r\n                                    data-backgroundcolor=\"#fff\"\r\n                                    disabled={comic[0].state ? true : false}\r\n                                >\r\n                                    {label === t('收藏') && (\r\n                                        <>\r\n                                            {isFavorited ? (\r\n                                                <HeartFill\r\n                                                    className=\"me-2\"\r\n                                                    style={{ color: '#F6B93B', cursor: 'pointer' }}\r\n                                                    size={20}\r\n                                                />\r\n                                            ) : (\r\n                                                <Heart\r\n                                                    className=\"me-2\"\r\n                                                    style={{ color: 'black', cursor: 'pointer' }}\r\n                                                    size={20}\r\n                                                />\r\n                                            )}\r\n                                        </>\r\n                                    )}\r\n                                    {label}\r\n                                </Button>\r\n                            </Col>\r\n                        ))}\r\n                    </Row>\r\n                    <Row>\r\n                        <Col className=\"text-section\">\r\n                            {comic.map((comic, index) => (\r\n                                <React.Fragment key={index}>\r\n                                    <h3 className={`fw-bold ${comic.state && 'delete-line'}`}>{comic.title}</h3>\r\n                                    {comic.state ? (\r\n                                        <p>\r\n                                            <span className=\"comicDetail-penName delete-line\">{comic.penName}</span> \r\n                                            <span className=\"address delete-line\">({comic.author})</span>\r\n                                        </p>\r\n                                    ) : (\r\n                                        <Link to={`/authorProfile/${comic.author === t('您是本作品的創作者') ? currentAccount : comic.author}`}>\r\n                                            <p>\r\n                                                <span className=\"comicDetail-penName\">{comic.penName}</span> \r\n                                                <span className=\"address\">({comic.author})</span>\r\n                                            </p>\r\n                                        </Link>\r\n                                    )}\r\n                                    <p>{t('發布日期')}：{comic.release}</p>\r\n                                    <p>{t('最新章節')}：{comic.chapter}<span className=\"text-secondary\">...{comic.date}</span></p>\r\n                                    <p className={`text-secondary ${comic.state && 'delete-line'}`}>{comic.description}</p>\r\n                                </React.Fragment>\r\n                            ))}\r\n                        </Col>\r\n                    </Row>\r\n                    <Row className='pt-5 chapter-title-section'>\r\n                        <Col>\r\n                            <div className='d-flex justify-content-between align-items-center'>\r\n                                <h3 className='fw-bold mb-0'>{t('章節目錄')}</h3>\r\n                                <p className='text-end mb-0'>{t('查看全部章節')}</p>\r\n                            </div>\r\n                            <hr />\r\n                        </Col>\r\n                    </Row>\r\n                    <Row className='justify-content-center'>\r\n                        <Col className='d-flex justify-content-center chapter-table'>\r\n                            <Table size=\"sm\">\r\n                                <tbody>\r\n                                    {currentChapters.map((chapter, index) => (\r\n                                        <tr key={index}>\r\n                                            <td className='text-center fw-bold'>{t('第幾章', { chapter: startIndex + index + 1 })}</td>\r\n                                            <td className='text-center'>{chapter.title}</td>\r\n                                            <td className='text-center'>{chapter.price}</td>\r\n                                            <td className='text-center'>\r\n                                                <button onClick={() => handlePurchase(index)} className={`btn ${chapter.isBuying === t('閱讀') ? 'read-button' : 'buy-button'}`} value={chapter.isBuying}>{chapter.isBuying}</button>\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </Table>\r\n                        </Col>\r\n                    </Row>\r\n                    <Row className='pt-2 pb-5 justify-content-center table-button'>\r\n                        <Col className='d-flex justify-content-center'>\r\n                            <ButtonToolbar aria-label=\"Toolbar with pagination\">\r\n                                <Pagination>\r\n                                    <Pagination.Prev \r\n                                        onClick={() => handlePageChange(currentPage - 1)} disabled={currentPage <= 1} \r\n                                        className='pagination-button'\r\n                                    />\r\n                                    {getPageItems()}\r\n                                    <Pagination.Next \r\n                                        onClick={() => handlePageChange(currentPage + 1)} disabled={currentPage >= totalPages} \r\n                                        className='pagination-button'\r\n                                    />\r\n                                </Pagination>\r\n                            </ButtonToolbar>\r\n                        </Col>\r\n                    </Row>\r\n                    <Row>\r\n                        <h3 className=\"fw-bold\">{t('類似漫畫')}</h3>\r\n                    </Row>\r\n                    <Row xs={1} md={2} className=\"g-4 pb-5\">\r\n                        {similComic.map((data, idx) => (\r\n                            <Col key={idx} xs={6} md={3} className=\"pt-3\">\r\n                                <Link to={`/comicDetail/${data.comicID}`}>\r\n                                    <Card className=\"ranking-thumbnail-position\">\r\n                                        <OverlayTrigger placement=\"top\" overlay={renderTooltip(data.description)}>\r\n                                            <Card.Img variant=\"top\" src={data.image} />\r\n                                        </OverlayTrigger>\r\n                                        <div className=\"comicDetail-createTime\" style={{marginBottom: \"0px\"}}>{data.penName}</div>\r\n                                        <div className=\"comicDetail-createTime\">{data.date}</div>\r\n                                        <Card.Body>\r\n                                            <Card.Title className='text-center'>{data.title}</Card.Title>\r\n                                            <Card.Text className=\"comicDetail-text\">{data.description}</Card.Text>\r\n                                        </Card.Body>\r\n                                    </Card>\r\n                                </Link>\r\n                            </Col>\r\n                        ))}\r\n                    </Row>\r\n                </Container>\r\n            )}\r\n            {loading && (\r\n                <div className=\"loading-container\">\r\n                    <div>{t('頁面加載中')}</div>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default ComicDetail;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}