{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import{Container,Form,Row,Col,Button,ProgressBar}from'react-bootstrap';import{message}from'antd';import Web3 from'web3';import comicData from'../contracts/ComicPlatform.json';import $ from'jquery';import{useLocation}from'react-router-dom';import{sortByTimestamp,disableAllButtons,enableAllButtons,getTranslationKey}from'../index';import{useTranslation}from'react-i18next';import i18n from'../i18n';import axios from'axios';import CryptoJS from'crypto-js';import{MdClose,MdDragHandle}from'react-icons/md';// 導入小叉叉圖標和拖曳圖標\nimport{DragDropContext,Draggable,Droppable}from'react-beautiful-dnd';// 拖放功能，讓使用者可以拖曳圖片來重新排列它們的順序。\nimport imageCompression from'browser-image-compression';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const website=process.env.REACT_APP_Website;const API_KEY=process.env.REACT_APP_API_KEY;const EditWork=props=>{const[web3,setWeb3]=useState(null);const[contract,setContract]=useState(null);const[msg,updateMsg]=useState('');const[stepCompleted,setStepCompleted]=useState(false);const[showChapterForm,setShowChapterForm]=useState(false);const[previewImageUrl,setPreviewImageUrl]=useState(null);const[previewImageUrls,setPreviewImageUrls]=useState([]);// 多個圖片預覽\nconst[comicHash,setComicHash]=useState('');const location=useLocation();const[file,setFiles]=useState('');const[chapterID,setChapterID]=useState('');const currentAccount=localStorage.getItem(\"currentAccount\");const[comic,setComic]=useState([]);const[chapter,setChapter]=useState([]);// 原始 chapter\nconst[newComic,setNewComic]=useState({category:'',title:'',description:'',imgURL:''});const[newChapter,setNewChapter]=useState({chapterTitle:'',price:'',chapterHash:'',imgURL:'',isFree:false});const[coverFile,setCoverFile]=useState('');const[promoPreviewImageUrl,setPromoPreviewImageUrl]=useState('');const[loading,setLoading]=useState(false);const{t}=useTranslation();const language=localStorage.getItem('language')||i18n.language;const headers={'api-key':API_KEY};const[grading,setGrading]=useState([\"戀愛\",\"懸疑\",\"恐怖\",\"冒險\",\"古風\",\"玄幻\",\"武俠\",\"搞笑\"]);let tempCH=[];let chapterInfo=[];let mergedFile='';// 連接到 Web3 的函數\nasync function connectToWeb3(){if(window.ethereum){try{const web3=new Web3(window.ethereum);setWeb3(web3);const contractInstance=new web3.eth.Contract(comicData.abi,comicData.address);setContract(contractInstance);try{const response=await axios.get(\"\".concat(website,\"/api/editWork/chapters\"),{headers:headers,params:{comicHash:tempCH[0].comicHash,currentAccount:currentAccount}});let chapters=response.data;sortByTimestamp(chapters);//console.log(chapters);\nfor(var i=0;i<chapters.length;i++){let id='Chapter'+(i+1);if(id==location.state.chapterID){let price=chapters[i].price;const chapterResponse=await axios.get(\"\".concat(website,\"/api/chapterIMG/\").concat(chapters[i].chapterHash),{responseType:'blob',headers});let imgURL=URL.createObjectURL(chapterResponse.data);setNewChapter({chapterTitle:chapters[i].title,price:price,imgURL:imgURL});setChapter({chapterTitle:chapters[i].title,price:price,chapterHash:chapters[i].chapterHash,imgURL:imgURL});}}}catch(error){console.error('Error fetching records:',error);}}catch(error){console.error(error);}}else{message.info(t('請安裝MetaMask'));}};// 漫畫編輯函數\nconst editComic=async e=>{e.preventDefault();try{const fillFile=await checkFile();if(fillFile===-1){return;}disableAllButtons();updateMsg(t('正在編輯漫畫資料中'));if(comic[0].category===newComic.category&&comic[0].title===newComic.title&&comic[0].description===newComic.description&&!file&&!coverFile){message.info(t('目前您未編輯任何東西'));updateMsg(\"\");enableAllButtons();return-1;}else if(comic[0].title!=newComic.title){// 只變更title\ntry{await contract.methods.editComic(comic[0].comic_id,newComic.title).send({from:currentAccount});const formData=new FormData();formData.append('id',comic[0].comic_id);formData.append('title',newComic.title);formData.append('description',newComic.description);formData.append('category',newComic.category);formData.append('fileName',comic[0].filename);// 原始圖檔名稱\nconst editComicData={'comicHash':comic[0].comic_id,'editTitle':newComic.title};if(file){// 有重新上傳圖片\nformData.append('comicIMG',file);}if(coverFile){formData.append('coverFile',coverFile);const protoFilename=\"promoCover.jpg\";formData.append('protoFilename',protoFilename);}else{formData.append('protoFilename','');};await axios.put(\"\".concat(website,\"/api/update/comicData\"),formData,{headers});localStorage.setItem('editComicData',JSON.stringify(editComicData));window.location.replace(\"/editSuccess\");}catch(error){if(error.message.includes('User denied transaction signature')){message.info(t('拒绝交易'));}else{alert(error);}enableAllButtons();updateMsg(\"\");}}else{const formData=new FormData();formData.append('id',comic[0].comic_id);formData.append('title',newComic.title);formData.append('description',newComic.description);formData.append('category',newComic.category);const editComicData={'comicHash':comic[0].comic_id,'editTitle':newComic.title};if(file){// 有重新上傳圖片\nformData.append('comicIMG',file);}if(coverFile){formData.append('coverFile',coverFile);const protoFilename=\"promoCover.jpg\";formData.append('protoFilename',protoFilename);}else{formData.append('protoFilename','');};await axios.put(\"\".concat(website,\"/api/update/comicData\"),formData,{headers});localStorage.setItem('editComicData',JSON.stringify(editComicData));window.location.replace(\"/editSuccess\");};}catch(error){alert(t('漫畫編輯時發生錯誤')+error);enableAllButtons();updateMsg(\"\");}};// 章節編輯函數\nconst editChapter=async e=>{if(e){e.preventDefault();}try{const fillFile=await checkFile();if(fillFile===-1){return;}let price_temp=newChapter.price;if(price_temp&&!isNaN(parseFloat(price_temp))){price_temp=parseFloat(price_temp);price_temp=web3.utils.toWei(price_temp.toString(),'ether');if(price_temp<10000000000000000&&newChapter.isFree===false){message.info(t('價格至少0.01 ETH'));return;}}disableAllButtons();updateMsg(t('正在編輯章節資料中'));if(chapter.price==newChapter.price&&chapter.chapterTitle==newChapter.chapterTitle&&file.length===0){message.info(t('目前您未編輯任何東西'));updateMsg(\"\");enableAllButtons();return-1;}else if(chapter.price!=newChapter.price||chapter.chapterTitle!=newChapter.chapterTitle){// 章節價格或標題有變動\ntry{await contract.methods.editChapter(comic[0].comic_id,chapter.chapterHash,newChapter.chapterTitle,price_temp).send({from:currentAccount});const formData=new FormData();formData.append('comic_id',comic[0].comic_id);formData.append('chapter_id',chapter.chapterHash);formData.append('price',newChapter.price);formData.append('title',newChapter.chapterTitle);if(file){await handleGeneratePages();// 等待合併圖片操作完成\nformData.append('chapterIMG',mergedFile);// 使用正确的字段名，这里是 'chapterIMG'\n}await axios.put(\"\".concat(website,\"/api/update/chapterData\"),formData,{headers});let editComicData={'comicHash':comic[0].comic_id,'editTitle':comic[0].title,editChapter:newChapter.chapterTitle};localStorage.setItem('editComicData',JSON.stringify(editComicData));window.location.replace(\"/editSuccess\");}catch(error){if(error.message.includes('User denied transaction signature')){message.info(t('拒绝交易'));}else{alert(error);}enableAllButtons();updateMsg(\"\");}}else{const formData=new FormData();formData.append('comic_id',comic[0].comic_id);formData.append('chapter_id',chapter.chapterHash);formData.append('price',newChapter.price);formData.append('title',newChapter.chapterTitle);if(file){await handleGeneratePages();// 等待合併圖片操作完成\nformData.append('chapterIMG',mergedFile);// 使用正确的字段名，这里是 'chapterIMG'\n}await axios.put(\"\".concat(website,\"/api/update/chapterData\"),formData,{headers});let editComicData={'comicHash':comic[0].comic_id,'editTitle':comic[0].title,editChapter:newChapter.chapterTitle};localStorage.setItem('editComicData',JSON.stringify(editComicData));window.location.replace(\"/editSuccess\");};//console.log(\"comicHash：\" + comic[0].comic_id);\n//console.log(\"chapterTitle：\" + newChapter.chapterTitle);\n//console.log(\"price：\" + newChapter.price);\n}catch(error){alert(t('章節編輯時發生錯誤')+error);enableAllButtons();updateMsg(\"\");}};// 處理單張圖片，資料驗證、預覽\nconst handleFileInputChange=async event=>{const file=event.target.files[0];if(!file){return;}if(validateFileType(file)){previewImage(file);if(file.size<600*1024){setFiles(file);return;}try{const compressedBlob=await imageCompression(file,{maxSizeMB:0.6});const compressFile=new File([compressedBlob],'file.jpg',{type:'image/jpeg',lastModified:Date.now()});setFiles(compressFile);}catch(error){alert(t('圖片壓縮錯誤：')+error);}}else{message.info(t('文件類型不支持，請上傳...格式的圖片'));return-1;}const reader=new FileReader();reader.readAsArrayBuffer(file);};// 處理多張圖片，資料驗證、預覽\nconst handleMultiFileInputChange=event=>{const files=event.target.files;const fileArray=Array.from(files);const urls=fileArray.map(file=>URL.createObjectURL(file));// 创建预览 URL\nfileArray.forEach(file=>{if(validateFileType(file)){previewImage(file);}else{message.info(t('文件類型不支持，請上傳...格式的圖片'));return-1;}});setFiles(prevFiles=>[...prevFiles,...fileArray]);// 添加新文件到旧文件列表中\nsetPreviewImageUrls(prevUrls=>[...prevUrls,...urls]);// 添加新预览 URL 到旧预览 URL 列表中\n};const createPromoCover=async event=>{const file=event.target.files[0];if(!file){return;}if(validateFileType(file)){previewPromoCover(file);if(file.size<600*1024){setCoverFile(file);return;}try{const compressedBlob=await imageCompression(file,{maxSizeMB:0.6});const compressFile=new File([compressedBlob],'file.jpg',{type:'image/jpeg',lastModified:Date.now()});setCoverFile(compressFile);}catch(error){alert(t('圖片壓縮錯誤：')+error);}}else{message.info(t('文件類型不支持，請上傳...格式的圖片'));return-1;}};// 驗證檔案類型是否符合要求\nconst validateFileType=file=>{const allowedTypes=[\"image/jpeg\",\"image/png\",\"image/jpg\"];return allowedTypes.includes(file.type);};// 預覽圖片\nconst previewImage=file=>{const reader=new FileReader();reader.readAsDataURL(file);reader.onloadend=()=>{setPreviewImageUrl(reader.result);};};// 預覽圖片\nconst previewPromoCover=file=>{const reader=new FileReader();reader.readAsDataURL(file);reader.onloadend=()=>{setPromoPreviewImageUrl(reader.result);};};// 处理单张图片的删除\nconst handleRemoveCover=()=>{setFiles(null);setPreviewImageUrl(null);};const handleRemovePromo=()=>{setCoverFile(null);setPromoPreviewImageUrl(null);};// 允許使用者刪除不需要的文件預覽\nconst handleRemoveFile=index=>{const newFiles=[...file];const newUrls=[...previewImageUrls];newFiles.splice(index,1);newUrls.splice(index,1);setFiles(newFiles);setPreviewImageUrls(newUrls);};const handleDragEnd=result=>{if(!result.destination){return;}const items=[...file];const urls=[...previewImageUrls];const[reorderedItem]=items.splice(result.source.index,1);const[reorderedUrl]=urls.splice(result.source.index,1);items.splice(result.destination.index,0,reorderedItem);urls.splice(result.destination.index,0,reorderedUrl);setFiles(items);setPreviewImageUrls(urls);};// 漫畫類型取值\nfunction ChoseLevel(e){let choseLevel=e.target.value;let rewind=getTranslationKey(choseLevel,language);setNewComic({...newComic,category:rewind});};async function checkFile(){if(showChapterForm==false){const{category,title,description}=newComic;// 檔案不可為空\nif(!category||!title||!description)// || 其中一個為true，即為true\n{updateMsg(t('請填寫所有欄位'));return-1;}}else{const{chapterTitle,price}=newChapter;// 檔案不可為空\nif(!comicHash||!chapterTitle||!newChapter.isFree&&!price){updateMsg(t('請填寫所有欄位'));return-1;}};};useEffect(()=>{const fetchData=async()=>{if(location.state){//console.log(\"Location state:\", location.state);\nsetShowChapterForm(location.state.showChapterForm);const storedArrayJSON=localStorage.getItem('comicDatas');const storedArray=JSON.parse(storedArrayJSON);const temp=storedArray.filter(item=>item.comicID===location.state.comicID);//console.log(temp);\nsetComic(temp);tempCH.push({'comicHash':temp[0].comic_id});try{const[imageResponse,protoResponse]=await Promise.all([axios.get(\"\".concat(website,\"/api/comicIMG/\").concat(temp[0].comic_id),{responseType:'blob',headers}),temp[0].protoFilename?axios.get(\"\".concat(website,\"/api/coverFile/\").concat(temp[0].comic_id),{responseType:'blob',headers}):Promise.resolve(null)]);const imgURL=URL.createObjectURL(imageResponse.data);const coverImg=protoResponse?URL.createObjectURL(protoResponse.data):'';setNewComic({category:temp[0].category,title:temp[0].title,description:temp[0].description,imgURL:imgURL,coverImg:coverImg});if(location.state.chapterID){setComicHash(temp[0].comic_id);setChapterID(location.state.chapterID);}connectToWeb3();setLoading(true);}catch(error){console.error('Error fetching data:',error);}}};fetchData();},[location.state,currentAccount]);// 处理生成合并图片并进行翻页\nconst handleGeneratePages=async()=>{return new Promise(async(resolve,reject)=>{const singleFile=file[0];if(file.length===1){if(singleFile.size<600*1024){mergedFile=singleFile;// 尺寸小於600KB，直接回傳\nresolve();return;}try{const compressedBlob=await imageCompression(singleFile,{maxSizeMB:0.6});mergedFile=new File([compressedBlob],'compress.jpg',{type:'image/jpeg',lastModified:Date.now()});resolve();}catch(error){alert(t('圖片壓縮錯誤：')+error);reject(error);}}else{const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');canvas.width=file.length*1200;// 合併後的寬度\ncanvas.height=1600;// 固定高度\nawait Promise.all(file.map((file,index)=>{return new Promise(resolve=>{const img=new Image();img.onload=()=>{ctx.drawImage(img,index*1200,0,1200,1600);resolve();};img.src=URL.createObjectURL(file);});}));canvas.toBlob(async blob=>{const mergedFileBlob=new Blob([blob],{type:'image/jpeg'});try{const compressedBlob=await imageCompression(mergedFileBlob,{maxSizeMB:0.6,useWebWorker:true});const finalCanvas=document.createElement('canvas');finalCanvas.width=canvas.width;finalCanvas.height=canvas.height;const finalCtx=finalCanvas.getContext('2d');const compressedImage=new Image();compressedImage.onload=()=>{finalCtx.drawImage(compressedImage,0,0,finalCanvas.width,finalCanvas.height);finalCanvas.toBlob(finalBlob=>{mergedFile=new File([finalBlob],'compress.jpg',{type:'image/jpeg',lastModified:Date.now()});// 创建下载链接并触发下载\n//const downloadLink = document.createElement('a');\n//downloadLink.href = URL.createObjectURL(mergedFile);\n//downloadLink.download = fileName;\n//downloadLink.click();\nresolve();},'image/jpeg');};compressedImage.src=URL.createObjectURL(new Blob([compressedBlob]));}catch(error){alert(t('圖片壓縮錯誤：')+error);reject(error);}},'image/jpeg');}});};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"upload-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"step-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"step-item \".concat(stepCompleted&&!showChapterForm?'step-completed':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"step-line\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"line \".concat(stepCompleted?'bg-blue':'bg-gray')}),/*#__PURE__*/_jsx(\"div\",{className:\"dot\",children:\"1\"}),/*#__PURE__*/_jsx(\"div\",{className:\"line \".concat(stepCompleted?'bg-blue':'bg-gray')})]}),/*#__PURE__*/_jsx(\"div\",{className:\"step-title\",children:t('編輯漫畫')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"step-item \".concat(!showChapterForm&&!stepCompleted?'step-item-gray':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"step-line\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"line \".concat(!showChapterForm&&!stepCompleted?'bg-gray':'bg-blue')}),/*#__PURE__*/_jsx(\"div\",{className:\"dot\",children:\"2\"}),/*#__PURE__*/_jsx(\"div\",{className:\"line \".concat(!showChapterForm&&!stepCompleted?'bg-gray':'bg-blue')})]}),/*#__PURE__*/_jsx(\"div\",{className:\"step-title\",children:t('編輯章節')})]})]}),loading?/*#__PURE__*/_jsx(_Fragment,{children:showChapterForm?/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mb-3 label-container\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,sm:3,className:\"label-style col-form-label label-section\",children:t('本章名稱')}),/*#__PURE__*/_jsx(Col,{sm:9,children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:newChapter.chapterTitle,placeholder:t('請輸入章節名稱'),onChange:e=>setNewChapter({...newChapter,chapterTitle:e.target.value})})})]}),/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mb-3 label-container\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,sm:3,className:\"label-style col-form-label label-section\",children:t('本章價格')}),/*#__PURE__*/_jsx(Col,{sm:9,children:/*#__PURE__*/_jsx(Form.Control,{type:\"number\",value:newChapter.price==0?'0':newChapter.price// 如果 isFree 為 true，顯示 '0'，否則顯示 formParams_1.price\n,placeholder:t('至少 0.01 ETH'),step:\"0.01\",disabled:newChapter.isFree,onChange:e=>setNewChapter({...newChapter,price:e.target.value})})})]}),/*#__PURE__*/_jsx(Form.Group,{as:Row,className:\"mb-3\",children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex'},children:[/*#__PURE__*/_jsx(Form.Label,{column:true,sm:3,className:\"label-style  \",children:t('本章免費')}),/*#__PURE__*/_jsx(Form.Check,{type:\"checkbox\",onChange:e=>{const isFree=e.target.checked;setNewChapter({...newChapter,isFree:isFree,price:isFree?0:newChapter.price// 如果是免费，则将价格设为 0，否则保持原来的价格\n});},checked:newChapter.isFree,style:{transform:'scale(1.8)',marginTop:'12px',marginLeft:'1.3rem'}})]})}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Form.Label,{className:\"label-style mb-3 col-form-label\",children:t('本章作品上傳')}),/*#__PURE__*/_jsx(\"h6\",{style:{marginLeft:'10px'},children:t('如不需變更內容，則無需上傳圖檔')})]}),/*#__PURE__*/_jsx(Form.Control,{type:\"file\",onChange:handleMultiFileInputChange,multiple:true}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:'1 1 45%',textAlign:'left',marginRight:'10px'},children:[/*#__PURE__*/_jsx(\"div\",{children:t('更改前的章節內容')}),/*#__PURE__*/_jsx(\"br\",{}),newChapter.imgURL&&/*#__PURE__*/_jsx(\"img\",{src:newChapter.imgURL,alt:\"Preview\",style:{width:'80%',paddingBottom:'3%'}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:'1 1 45%',textAlign:'right'},children:[/*#__PURE__*/_jsx(\"div\",{children:t('更改後的章節內容')}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:handleDragEnd,children:/*#__PURE__*/_jsx(Droppable,{droppableId:\"droppable\",children:provided=>/*#__PURE__*/_jsxs(\"div\",{ref:provided.innerRef,...provided.droppableProps,className:\"image-list\",style:{display:'flex',flexWrap:'wrap',gap:'10px',justifyContent:'flex-end'},children:[previewImageUrls.map((url,index)=>/*#__PURE__*/_jsx(Draggable,{draggableId:\"draggable-\".concat(index),index:index,children:provided=>/*#__PURE__*/_jsxs(\"div\",{ref:provided.innerRef,...provided.draggableProps,...provided.dragHandleProps,className:\"image-item\",style:{position:'relative'},children:[/*#__PURE__*/_jsx(\"img\",{src:url,alt:\"Preview \".concat(index),className:\"preview-image\",style:{width:'80%',height:'auto',paddingBottom:'3%'}}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleRemoveFile(index),type:\"button\",style:{backgroundColor:'white',position:'absolute',top:'5px',right:'5px'},className:\"remove-button\",children:/*#__PURE__*/_jsx(MdClose,{className:\"MdClose-button\"})}),/*#__PURE__*/_jsx(MdDragHandle,{style:{position:'absolute',bottom:'5px',right:'5px',cursor:'grab'}})]})},index)),provided.placeholder]})})})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-red-500 text-center\",children:msg}),/*#__PURE__*/_jsx(Button,{onClick:editChapter,id:\"list-button\",\"data-backgroundcolor\":\"#fff\",children:t('提交')})]}):/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mb-3 label-container\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,sm:3,className:\"label-style label-section\",children:t('漫畫名稱')}),/*#__PURE__*/_jsx(Col,{sm:9,children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:newComic.title,onChange:e=>setNewComic({...newComic,title:e.target.value})})})]}),/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mb-3 label-container\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,sm:3,className:\"label-style label-section\",children:t('漫畫類型')}),/*#__PURE__*/_jsx(Col,{sm:9,children:/*#__PURE__*/_jsxs(Form.Control,{as:\"select\",className:\"form-select\",value:t(newComic.category),onChange:ChoseLevel,children:[/*#__PURE__*/_jsx(\"option\",{children:t('請選擇漫畫類型')}),grading.map((name,index)=>/*#__PURE__*/_jsx(\"option\",{children:t(name)},index))]})})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"pb-4\",children:[/*#__PURE__*/_jsx(Form.Label,{className:\"label-style mb-3 col-form-label\",children:t('漫畫簡介')}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:5,value:newComic.description,onChange:e=>setNewComic({...newComic,description:e.target.value})})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"pb-5\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Form.Label,{className:\"label-style mb-1 col-form-label\",htmlFor:\"image\",children:t('漫畫封面')}),/*#__PURE__*/_jsx(\"h6\",{style:{marginLeft:'10px'},children:t('如不需變更封面，則無需上傳圖檔')})]}),/*#__PURE__*/_jsx(Form.Control,{type:\"file\",onChange:handleFileInputChange}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:'1 1 45%',marginRight:'20px',textAlign:'left'},children:[/*#__PURE__*/_jsx(\"div\",{children:t('更改前的圖片封面')}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"img\",{src:newComic.imgURL,alt:\"Preview\",style:{width:'80%',maxWidth:'300px',paddingBottom:'3%'}})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:'1 1 45%',textAlign:'right'},children:[/*#__PURE__*/_jsx(\"div\",{children:t('更改後的圖片封面')}),/*#__PURE__*/_jsx(\"br\",{}),previewImageUrl&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',display:'inline-block'},children:[/*#__PURE__*/_jsx(\"img\",{src:previewImageUrl,alt:\"Preview\",style:{width:'80%',maxWidth:'300px',paddingBottom:'3%'}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRemoveCover,type:\"button\",style:{backgroundColor:'white',position:'absolute',top:'5px',right:'5px'},className:\"remove-button\",children:/*#__PURE__*/_jsx(MdClose,{className:\"MdClose-button\"})})]})]})]})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"pb-5\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Form.Label,{className:\"label-style mb-1 col-form-label\",htmlFor:\"image\",children:t('漫畫橫向封面')}),/*#__PURE__*/_jsx(\"h6\",{style:{marginLeft:'10px'},children:t('如不需變更封面，則無需上傳圖檔')})]}),/*#__PURE__*/_jsx(Form.Control,{type:\"file\",onChange:createPromoCover}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:'1 1 45%',marginRight:'20px',textAlign:'left'},children:[/*#__PURE__*/_jsx(\"div\",{children:t('更改前的橫向封面')}),/*#__PURE__*/_jsx(\"br\",{}),newComic.coverImg?/*#__PURE__*/_jsx(\"img\",{src:newComic.coverImg,alt:\"Preview\",style:{width:'80%',maxWidth:'300px',paddingBottom:'3%'}}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:t('目前無上傳橫向封面')}),/*#__PURE__*/_jsx(\"br\",{})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:'1 1 45%',textAlign:'right'},children:[/*#__PURE__*/_jsx(\"div\",{children:t('更改後的橫向封面')}),/*#__PURE__*/_jsx(\"br\",{}),promoPreviewImageUrl&&/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',display:'inline-block'},children:[/*#__PURE__*/_jsx(\"img\",{src:promoPreviewImageUrl,alt:\"Preview\",style:{width:'80%',maxWidth:'300px',paddingBottom:'3%'}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRemovePromo,type:\"button\",style:{backgroundColor:'white',position:'absolute',top:'5px',right:'5px'},className:\"remove-button\",children:/*#__PURE__*/_jsx(MdClose,{className:\"MdClose-button\"})})]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-red-500 text-center\",children:msg}),/*#__PURE__*/_jsx(Button,{onClick:editComic,id:\"list-button\",\"data-backgroundcolor\":\"#fff\",children:t('提交')})]})}):/*#__PURE__*/_jsx(\"div\",{className:\"loading-container\",children:/*#__PURE__*/_jsx(\"div\",{children:t('頁面加載中')})})]})});};export default EditWork;","map":{"version":3,"names":["React","useState","useEffect","Link","Container","Form","Row","Col","Button","ProgressBar","message","Web3","comicData","$","useLocation","sortByTimestamp","disableAllButtons","enableAllButtons","getTranslationKey","useTranslation","i18n","axios","CryptoJS","MdClose","MdDragHandle","DragDropContext","Draggable","Droppable","imageCompression","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","website","process","env","REACT_APP_Website","API_KEY","REACT_APP_API_KEY","EditWork","props","web3","setWeb3","contract","setContract","msg","updateMsg","stepCompleted","setStepCompleted","showChapterForm","setShowChapterForm","previewImageUrl","setPreviewImageUrl","previewImageUrls","setPreviewImageUrls","comicHash","setComicHash","location","file","setFiles","chapterID","setChapterID","currentAccount","localStorage","getItem","comic","setComic","chapter","setChapter","newComic","setNewComic","category","title","description","imgURL","newChapter","setNewChapter","chapterTitle","price","chapterHash","isFree","coverFile","setCoverFile","promoPreviewImageUrl","setPromoPreviewImageUrl","loading","setLoading","t","language","headers","grading","setGrading","tempCH","chapterInfo","mergedFile","connectToWeb3","window","ethereum","contractInstance","eth","Contract","abi","address","response","get","concat","params","chapters","data","i","length","id","state","chapterResponse","responseType","URL","createObjectURL","error","console","info","editComic","e","preventDefault","fillFile","checkFile","methods","comic_id","send","from","formData","FormData","append","filename","editComicData","protoFilename","put","setItem","JSON","stringify","replace","includes","alert","editChapter","price_temp","isNaN","parseFloat","utils","toWei","toString","handleGeneratePages","handleFileInputChange","event","target","files","validateFileType","previewImage","size","compressedBlob","maxSizeMB","compressFile","File","type","lastModified","Date","now","reader","FileReader","readAsArrayBuffer","handleMultiFileInputChange","fileArray","Array","urls","map","forEach","prevFiles","prevUrls","createPromoCover","previewPromoCover","allowedTypes","readAsDataURL","onloadend","result","handleRemoveCover","handleRemovePromo","handleRemoveFile","index","newFiles","newUrls","splice","handleDragEnd","destination","items","reorderedItem","source","reorderedUrl","ChoseLevel","choseLevel","value","rewind","fetchData","storedArrayJSON","storedArray","parse","temp","filter","item","comicID","push","imageResponse","protoResponse","Promise","all","resolve","coverImg","reject","singleFile","canvas","document","createElement","ctx","getContext","width","height","img","Image","onload","drawImage","src","toBlob","blob","mergedFileBlob","Blob","useWebWorker","finalCanvas","finalCtx","compressedImage","finalBlob","children","className","Group","as","Label","column","sm","Control","placeholder","onChange","step","disabled","style","display","Check","checked","transform","marginTop","marginLeft","alignItems","multiple","justifyContent","flexWrap","flex","textAlign","marginRight","alt","paddingBottom","onDragEnd","droppableId","provided","ref","innerRef","droppableProps","gap","url","draggableId","draggableProps","dragHandleProps","position","onClick","backgroundColor","top","right","bottom","cursor","name","rows","htmlFor","maxWidth"],"sources":["C:/Users/user1/Desktop/blockchain-comics-platform/frontend/src/routes/editWork.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { Container,Form, Row, Col, Button, ProgressBar } from 'react-bootstrap';\r\nimport { message } from 'antd';\r\nimport Web3 from 'web3';\r\nimport comicData from '../contracts/ComicPlatform.json';\r\nimport $ from 'jquery';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { sortByTimestamp, disableAllButtons, enableAllButtons, getTranslationKey } from '../index';\r\nimport { useTranslation } from 'react-i18next';\r\nimport i18n from '../i18n';\r\nimport axios from 'axios';\r\nimport CryptoJS from 'crypto-js';\r\nimport { MdClose, MdDragHandle } from 'react-icons/md';  // 導入小叉叉圖標和拖曳圖標\r\nimport { DragDropContext, Draggable, Droppable } from 'react-beautiful-dnd';  // 拖放功能，讓使用者可以拖曳圖片來重新排列它們的順序。\r\nimport imageCompression from 'browser-image-compression';\r\nconst website = process.env.REACT_APP_Website;\r\nconst API_KEY = process.env.REACT_APP_API_KEY;\r\n\r\nconst EditWork = (props) => {\r\n  const [web3, setWeb3] = useState(null);\r\n  const [contract, setContract] = useState(null);\r\n  const [msg, updateMsg] = useState('');\r\n  const [stepCompleted, setStepCompleted] = useState(false);\r\n  const [showChapterForm, setShowChapterForm] = useState(false);\r\n  const [previewImageUrl, setPreviewImageUrl] = useState(null);\r\n  const [previewImageUrls, setPreviewImageUrls] = useState([]); // 多個圖片預覽\r\n  const [comicHash, setComicHash] = useState('');\r\n  const location = useLocation();\r\n  const [file, setFiles] = useState('');\r\n  const [chapterID, setChapterID] = useState('');\r\n  const currentAccount = localStorage.getItem(\"currentAccount\");\r\n  const [comic, setComic] = useState([]);\r\n  const [chapter, setChapter] = useState([]);  // 原始 chapter\r\n  const [newComic, setNewComic] = useState({category:'',  title: '', description: '', imgURL: ''});\r\n  const [newChapter, setNewChapter] = useState({chapterTitle: '', price: '', chapterHash: '', imgURL: '', isFree: false});\r\n  const [coverFile, setCoverFile] = useState('');\r\n  const [promoPreviewImageUrl, setPromoPreviewImageUrl] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const { t } = useTranslation();\r\n  const language = localStorage.getItem('language') || i18n.language;\r\n  const headers = {'api-key': API_KEY};\r\n  const [grading, setGrading] = useState([\r\n    \"戀愛\",\r\n    \"懸疑\",\r\n    \"恐怖\",\r\n    \"冒險\",\r\n    \"古風\",\r\n    \"玄幻\",\r\n    \"武俠\",\r\n    \"搞笑\"\r\n  ]);\r\n  let tempCH = [];\r\n  let chapterInfo = [];\r\n  let mergedFile = '';\r\n  \r\n  // 連接到 Web3 的函數\r\n  async function connectToWeb3(){\r\n    if (window.ethereum) {\r\n      try {\r\n        const web3 = new Web3(window.ethereum);\r\n        setWeb3(web3);\r\n        const contractInstance = new web3.eth.Contract(comicData.abi, comicData.address);\r\n        setContract(contractInstance);\r\n        try {\r\n          const response = await axios.get(`${website}/api/editWork/chapters`, {\r\n              headers: headers,\r\n              params: {\r\n                comicHash: tempCH[0].comicHash,\r\n                currentAccount: currentAccount\r\n              }\r\n          });\r\n          let chapters = response.data;\r\n          sortByTimestamp(chapters);\r\n          //console.log(chapters);\r\n          \r\n          for (var i = 0; i < chapters.length; i++) {\r\n              let id = 'Chapter' + (i+1);\r\n              if (id == location.state.chapterID) {\r\n                let price = chapters[i].price;\r\n                const chapterResponse = await axios.get(`${website}/api/chapterIMG/${chapters[i].chapterHash}`, { responseType: 'blob', headers });\r\n                let imgURL = URL.createObjectURL(chapterResponse.data);\r\n                setNewChapter({\r\n                  chapterTitle: chapters[i].title,\r\n                  price: price,\r\n                  imgURL: imgURL\r\n                });\r\n                setChapter({\r\n                  chapterTitle: chapters[i].title,\r\n                  price: price,\r\n                  chapterHash: chapters[i].chapterHash,\r\n                  imgURL: imgURL,\r\n                })\r\n              }\r\n          }\r\n        } catch (error) {\r\n            console.error('Error fetching records:', error);\r\n        }\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    } else {\r\n      message.info(t('請安裝MetaMask'));\r\n    }\r\n  };\r\n\r\n  // 漫畫編輯函數\r\n  const editComic = async (e) => {\r\n    e.preventDefault();\r\n    try {\r\n      const fillFile = await checkFile();\r\n      if(fillFile === -1){\r\n        return;\r\n      }\r\n      disableAllButtons();\r\n      updateMsg(t('正在編輯漫畫資料中'))\r\n      \r\n      if (comic[0].category === newComic.category &&\r\n        comic[0].title === newComic.title &&\r\n        comic[0].description === newComic.description &&\r\n        !file && !coverFile\r\n      ) {\r\n        message.info(t('目前您未編輯任何東西'));\r\n        updateMsg(\"\");\r\n        enableAllButtons();\r\n        return -1;\r\n      }else if (comic[0].title != newComic.title) {  // 只變更title\r\n        try {\r\n          await contract.methods.editComic(comic[0].comic_id, newComic.title).send({ from: currentAccount });\r\n\r\n          const formData = new FormData();\r\n          formData.append('id', comic[0].comic_id);\r\n          formData.append('title', newComic.title);\r\n          formData.append('description', newComic.description);\r\n          formData.append('category', newComic.category);\r\n          formData.append('fileName', comic[0].filename);  // 原始圖檔名稱\r\n          const editComicData = {'comicHash': comic[0].comic_id, 'editTitle': newComic.title};\r\n          if (file) { // 有重新上傳圖片\r\n            formData.append('comicIMG', file);\r\n          }\r\n          if (coverFile) {\r\n            formData.append('coverFile', coverFile);\r\n            const protoFilename = \"promoCover.jpg\";\r\n            formData.append('protoFilename', protoFilename);\r\n          } else {\r\n            formData.append('protoFilename', '');\r\n          };\r\n          await axios.put(`${website}/api/update/comicData`, formData, {headers});\r\n  \r\n          localStorage.setItem('editComicData', JSON.stringify(editComicData));\r\n          window.location.replace(\"/editSuccess\");\r\n        } catch (error) {\r\n          if (error.message.includes('User denied transaction signature')) {\r\n            message.info(t('拒绝交易'));\r\n          } else {\r\n            alert(error);\r\n          }\r\n          enableAllButtons();\r\n          updateMsg(\"\");\r\n        }\r\n      } else {\r\n        const formData = new FormData();\r\n        formData.append('id', comic[0].comic_id);\r\n        formData.append('title', newComic.title);\r\n        formData.append('description', newComic.description);\r\n        formData.append('category', newComic.category);\r\n        const editComicData = {'comicHash': comic[0].comic_id, 'editTitle': newComic.title};\r\n        if (file) { // 有重新上傳圖片\r\n          formData.append('comicIMG', file);\r\n        }\r\n        if (coverFile) {\r\n          formData.append('coverFile', coverFile);\r\n          const protoFilename = \"promoCover.jpg\";\r\n          formData.append('protoFilename', protoFilename);\r\n        } else {\r\n          formData.append('protoFilename', '');\r\n        };\r\n        await axios.put(`${website}/api/update/comicData`, formData, {headers});\r\n\r\n        localStorage.setItem('editComicData', JSON.stringify(editComicData));\r\n        window.location.replace(\"/editSuccess\");\r\n      };\r\n    } catch (error) {\r\n      alert(t('漫畫編輯時發生錯誤') + error);\r\n      enableAllButtons();\r\n      updateMsg(\"\");\r\n    }\r\n  };\r\n\r\n\r\n  // 章節編輯函數\r\n  const editChapter = async (e) => {\r\n    if (e) {\r\n      e.preventDefault();\r\n    }\r\n    try {\r\n      const fillFile = await checkFile();\r\n      if(fillFile === -1){\r\n        return;\r\n      }\r\n      let price_temp = newChapter.price;\r\n      if (price_temp && !isNaN(parseFloat(price_temp))) {\r\n        price_temp = parseFloat(price_temp);\r\n        price_temp = web3.utils.toWei(price_temp.toString(), 'ether');\r\n        if (price_temp < 10000000000000000 && newChapter.isFree === false) {\r\n          message.info(t('價格至少0.01 ETH'));\r\n          return;\r\n        }\r\n      }\r\n      disableAllButtons();\r\n      updateMsg(t('正在編輯章節資料中'))\r\n\r\n      if (chapter.price == newChapter.price && chapter.chapterTitle == newChapter.chapterTitle && file.length === 0) {\r\n        message.info(t('目前您未編輯任何東西'));\r\n        updateMsg(\"\");\r\n        enableAllButtons();\r\n        return -1;\r\n      } else if (chapter.price != newChapter.price || chapter.chapterTitle != newChapter.chapterTitle) {  // 章節價格或標題有變動\r\n        try {\r\n          await contract.methods.editChapter(comic[0].comic_id, chapter.chapterHash, newChapter.chapterTitle, price_temp).send({ from: currentAccount });\r\n\r\n          const formData = new FormData();\r\n          formData.append('comic_id', comic[0].comic_id);\r\n          formData.append('chapter_id', chapter.chapterHash);\r\n          formData.append('price', newChapter.price);\r\n          formData.append('title', newChapter.chapterTitle);\r\n          if (file) {\r\n            await handleGeneratePages();  // 等待合併圖片操作完成\r\n            formData.append('chapterIMG', mergedFile);  // 使用正确的字段名，这里是 'chapterIMG'\r\n          }\r\n          await axios.put(`${website}/api/update/chapterData`, formData, {headers});\r\n\r\n          let editComicData = {'comicHash': comic[0].comic_id, 'editTitle': comic[0].title, editChapter: newChapter.chapterTitle};\r\n          localStorage.setItem('editComicData', JSON.stringify(editComicData));\r\n          window.location.replace(\"/editSuccess\");\r\n        } catch (error) {\r\n          if (error.message.includes('User denied transaction signature')) {\r\n            message.info(t('拒绝交易'));\r\n          } else {\r\n            alert(error);\r\n          }\r\n          enableAllButtons();\r\n          updateMsg(\"\");\r\n        }\r\n      }else {\r\n        const formData = new FormData();\r\n        formData.append('comic_id', comic[0].comic_id);\r\n        formData.append('chapter_id', chapter.chapterHash);\r\n        formData.append('price', newChapter.price);\r\n        formData.append('title', newChapter.chapterTitle);\r\n        if (file) {\r\n          await handleGeneratePages();  // 等待合併圖片操作完成\r\n          formData.append('chapterIMG', mergedFile);  // 使用正确的字段名，这里是 'chapterIMG'\r\n        }\r\n        await axios.put(`${website}/api/update/chapterData`, formData, {headers});\r\n\r\n        let editComicData = {'comicHash': comic[0].comic_id, 'editTitle': comic[0].title, editChapter: newChapter.chapterTitle};\r\n        localStorage.setItem('editComicData', JSON.stringify(editComicData));\r\n        window.location.replace(\"/editSuccess\");\r\n      };\r\n      //console.log(\"comicHash：\" + comic[0].comic_id);\r\n      //console.log(\"chapterTitle：\" + newChapter.chapterTitle);\r\n      //console.log(\"price：\" + newChapter.price);\r\n    } catch (error) {\r\n      alert(t('章節編輯時發生錯誤') + error);\r\n      enableAllButtons();\r\n      updateMsg(\"\");\r\n    }\r\n  };\r\n\r\n  // 處理單張圖片，資料驗證、預覽\r\n  const handleFileInputChange = async (event) => {\r\n    const file = event.target.files[0];\r\n    if (!file) {\r\n      return;\r\n    }\r\n    if (validateFileType(file)) {\r\n      previewImage(file);\r\n      if (file.size < 600 * 1024) {\r\n        setFiles(file);\r\n        return;\r\n      }\r\n      try {\r\n        const compressedBlob = await imageCompression(file, { maxSizeMB: 0.6 });\r\n        const compressFile = new File([compressedBlob], 'file.jpg', { type: 'image/jpeg', lastModified: Date.now() });\r\n        setFiles(compressFile);\r\n      } catch (error) {\r\n        alert(t('圖片壓縮錯誤：') + error);\r\n      }\r\n    } else {\r\n      message.info(t('文件類型不支持，請上傳...格式的圖片'));\r\n      return -1;\r\n    }\r\n    const reader = new FileReader();\r\n    reader.readAsArrayBuffer(file);\r\n  };\r\n\r\n  // 處理多張圖片，資料驗證、預覽\r\n  const handleMultiFileInputChange = (event) => {\r\n    const files = event.target.files;\r\n    const fileArray = Array.from(files);\r\n    const urls = fileArray.map(file => URL.createObjectURL(file)); // 创建预览 URL\r\n    fileArray.forEach(file => {\r\n      if (validateFileType(file)) {\r\n        previewImage(file);\r\n      } else {\r\n        message.info(t('文件類型不支持，請上傳...格式的圖片'));\r\n        return -1;\r\n      }\r\n    });\r\n    setFiles(prevFiles => [...prevFiles, ...fileArray]);  // 添加新文件到旧文件列表中\r\n    setPreviewImageUrls(prevUrls => [...prevUrls, ...urls]);  // 添加新预览 URL 到旧预览 URL 列表中\r\n  };\r\n  \r\n\r\n  const createPromoCover = async (event) => {\r\n    const file = event.target.files[0];\r\n    if (!file) {\r\n      return;\r\n    }\r\n    if (validateFileType(file)) {\r\n      previewPromoCover(file);\r\n      if (file.size < 600 * 1024) {\r\n        setCoverFile(file);\r\n        return;\r\n      }\r\n      try {\r\n        const compressedBlob = await imageCompression(file, { maxSizeMB: 0.6 });\r\n        const compressFile = new File([compressedBlob], 'file.jpg', { type: 'image/jpeg', lastModified: Date.now() });\r\n        setCoverFile(compressFile);\r\n      } catch (error) {\r\n        alert(t('圖片壓縮錯誤：') + error);\r\n      }\r\n    } else {\r\n      message.info(t('文件類型不支持，請上傳...格式的圖片'));\r\n      return -1;\r\n    }\r\n  };\r\n\r\n  // 驗證檔案類型是否符合要求\r\n  const validateFileType = (file) => {\r\n    const allowedTypes = [\"image/jpeg\", \"image/png\", \"image/jpg\"];\r\n    return allowedTypes.includes(file.type);\r\n  };\r\n\r\n  // 預覽圖片\r\n  const previewImage = (file) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onloadend = () => {\r\n      setPreviewImageUrl(reader.result);\r\n    };\r\n  }; \r\n\r\n  // 預覽圖片\r\n  const previewPromoCover = (file) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onloadend = () => {\r\n      setPromoPreviewImageUrl(reader.result);\r\n    };\r\n  };\r\n\r\n  // 处理单张图片的删除\r\n  const handleRemoveCover = () => {\r\n    setFiles(null);\r\n    setPreviewImageUrl(null);\r\n  };\r\n\r\n  const handleRemovePromo = () => {\r\n    setCoverFile(null);\r\n    setPromoPreviewImageUrl(null);\r\n  };\r\n\r\n  // 允許使用者刪除不需要的文件預覽\r\n  const handleRemoveFile = (index) => {\r\n    const newFiles = [...file];\r\n    const newUrls = [...previewImageUrls];\r\n    newFiles.splice(index, 1);\r\n    newUrls.splice(index, 1);\r\n    setFiles(newFiles);\r\n    setPreviewImageUrls(newUrls);\r\n  };\r\n\r\n  const handleDragEnd = (result) => {\r\n    if (!result.destination) {\r\n      return;\r\n    }\r\n    const items = [...file];\r\n    const urls = [...previewImageUrls];\r\n    const [reorderedItem] = items.splice(result.source.index, 1);\r\n    const [reorderedUrl] = urls.splice(result.source.index, 1);\r\n    items.splice(result.destination.index, 0, reorderedItem);\r\n    urls.splice(result.destination.index, 0, reorderedUrl);\r\n    setFiles(items);\r\n    setPreviewImageUrls(urls);\r\n  };\r\n\r\n  // 漫畫類型取值\r\n  function ChoseLevel(e){\r\n    let choseLevel = e.target.value;\r\n    let rewind = getTranslationKey(choseLevel, language);\r\n    setNewComic({ ...newComic, category: rewind })\r\n  };\r\n\r\n  async function checkFile() {\r\n    if(showChapterForm == false){\r\n      const {category, title, description} = newComic;\r\n      // 檔案不可為空\r\n      if( !category || !title || !description)  // || 其中一個為true，即為true\r\n      {\r\n        updateMsg(t('請填寫所有欄位'))\r\n        return -1;\r\n      }\r\n    }else{\r\n      const {chapterTitle, price} = newChapter;\r\n      // 檔案不可為空\r\n      if(!comicHash || !chapterTitle || (!newChapter.isFree && !price))\r\n      {\r\n        updateMsg(t('請填寫所有欄位'))\r\n        return -1;\r\n      }\r\n    };\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n        if (location.state) {\r\n            //console.log(\"Location state:\", location.state);\r\n            setShowChapterForm(location.state.showChapterForm);\r\n            const storedArrayJSON = localStorage.getItem('comicDatas');\r\n            const storedArray = JSON.parse(storedArrayJSON);\r\n            const temp = storedArray.filter(item => item.comicID === location.state.comicID);\r\n            //console.log(temp);\r\n            setComic(temp);\r\n            tempCH.push({'comicHash': temp[0].comic_id})\r\n            try {\r\n                const [imageResponse, protoResponse] = await Promise.all([\r\n                    axios.get(`${website}/api/comicIMG/${temp[0].comic_id}`, { responseType: 'blob', headers }),\r\n                    temp[0].protoFilename ? axios.get(`${website}/api/coverFile/${temp[0].comic_id}`, { responseType: 'blob', headers }) : Promise.resolve(null)\r\n                ]);\r\n                const imgURL = URL.createObjectURL(imageResponse.data);\r\n                const coverImg = protoResponse ? URL.createObjectURL(protoResponse.data) : '';\r\n                setNewComic({\r\n                    category: temp[0].category,\r\n                    title: temp[0].title,\r\n                    description: temp[0].description,\r\n                    imgURL: imgURL,\r\n                    coverImg: coverImg\r\n                });\r\n                if (location.state.chapterID) {\r\n                    setComicHash(temp[0].comic_id);\r\n                    setChapterID(location.state.chapterID);\r\n                }\r\n                connectToWeb3();\r\n                setLoading(true);\r\n            } catch (error) {\r\n                console.error('Error fetching data:', error);\r\n            }\r\n        }\r\n    };\r\n    fetchData();\r\n}, [location.state, currentAccount]);\r\n\r\n  // 处理生成合并图片并进行翻页\r\n  const handleGeneratePages = async () => {\r\n    return new Promise(async (resolve, reject) => {\r\n      const singleFile = file[0];\r\n      if (file.length === 1) {\r\n        if (singleFile.size < 600 * 1024) {\r\n          mergedFile = singleFile; // 尺寸小於600KB，直接回傳\r\n          resolve();\r\n          return;\r\n        }\r\n        try {\r\n          const compressedBlob = await imageCompression(singleFile, { maxSizeMB: 0.6 });\r\n          mergedFile = new File([compressedBlob], 'compress.jpg', { type: 'image/jpeg', lastModified: Date.now() });\r\n            resolve();\r\n        } catch (error) {\r\n          alert(t('圖片壓縮錯誤：') + error);\r\n          reject(error);\r\n        }\r\n      } else {\r\n        const canvas = document.createElement('canvas');\r\n        const ctx = canvas.getContext('2d');\r\n        canvas.width = file.length * 1200; // 合併後的寬度\r\n        canvas.height = 1600; // 固定高度\r\n        await Promise.all(file.map((file, index) => {\r\n          return new Promise((resolve) => {\r\n            const img = new Image();\r\n            img.onload = () => {\r\n              ctx.drawImage(img, index * 1200, 0, 1200, 1600);\r\n              resolve();\r\n            };\r\n            img.src = URL.createObjectURL(file);\r\n          });\r\n        }));\r\n        canvas.toBlob(async (blob) => {\r\n          const mergedFileBlob = new Blob([blob], { type: 'image/jpeg' });\r\n          try {\r\n            const compressedBlob = await imageCompression(mergedFileBlob, { maxSizeMB: 0.6, useWebWorker: true });\r\n            const finalCanvas = document.createElement('canvas');\r\n            finalCanvas.width = canvas.width;\r\n            finalCanvas.height = canvas.height;\r\n            const finalCtx = finalCanvas.getContext('2d');\r\n            const compressedImage = new Image();\r\n            compressedImage.onload = () => {\r\n              finalCtx.drawImage(compressedImage, 0, 0, finalCanvas.width, finalCanvas.height);\r\n              finalCanvas.toBlob((finalBlob) => {\r\n                mergedFile = new File([finalBlob], 'compress.jpg', { type: 'image/jpeg', lastModified: Date.now() });\r\n                // 创建下载链接并触发下载\r\n                //const downloadLink = document.createElement('a');\r\n                //downloadLink.href = URL.createObjectURL(mergedFile);\r\n                //downloadLink.download = fileName;\r\n                //downloadLink.click();\r\n                resolve();\r\n              }, 'image/jpeg');\r\n            };\r\n            compressedImage.src = URL.createObjectURL(new Blob([compressedBlob]));\r\n          } catch (error) {\r\n            alert(t('圖片壓縮錯誤：') + error);\r\n            reject(error);\r\n          }\r\n        }, 'image/jpeg');\r\n      }\r\n    });\r\n  };\r\n\r\n\r\n  return (\r\n    <>\r\n      <div className=\"upload-form\">\r\n        <div className=\"step-container\">\r\n          <div className={`step-item ${stepCompleted && !showChapterForm ? 'step-completed' : ''}`}>\r\n            <div className=\"step-line\">\r\n              <div className={`line ${stepCompleted ? 'bg-blue' : 'bg-gray'}`}></div>\r\n              <div className=\"dot\">1</div>\r\n              <div className={`line ${stepCompleted ? 'bg-blue' : 'bg-gray'}`}></div>\r\n            </div>\r\n            <div className=\"step-title\">{t('編輯漫畫')}</div>\r\n          </div>\r\n          <div className={`step-item ${!showChapterForm && !stepCompleted ? 'step-item-gray' : ''}`}>\r\n            <div className=\"step-line\">\r\n              <div className={`line ${!showChapterForm && !stepCompleted ? 'bg-gray' : 'bg-blue'}`}></div>\r\n              <div className=\"dot\">2</div>\r\n              <div className={`line ${!showChapterForm && !stepCompleted ? 'bg-gray' : 'bg-blue'}`}></div>\r\n            </div>\r\n            <div className=\"step-title\">{t('編輯章節')}</div>\r\n          </div>\r\n        </div>\r\n        {loading ? (\r\n          <>\r\n            {showChapterForm ? (\r\n              <Form>\r\n                <Form.Group as={Row} className='mb-3 label-container'>\r\n                  <Form.Label column sm={3} className='label-style col-form-label label-section'>\r\n                    {t('本章名稱')}\r\n                  </Form.Label>\r\n                  <Col sm={9}>\r\n                    <Form.Control\r\n                      type=\"text\"\r\n                      value={newChapter.chapterTitle}\r\n                      placeholder={t('請輸入章節名稱')}\r\n                      onChange={(e) => setNewChapter({ ...newChapter, chapterTitle: e.target.value })}\r\n                    />\r\n                  </Col>\r\n                </Form.Group>\r\n  \r\n                <Form.Group as={Row} className='mb-3 label-container'>\r\n                  <Form.Label column sm={3} className='label-style col-form-label label-section'>\r\n                    {t('本章價格')}\r\n                  </Form.Label>\r\n                  <Col sm={9}>\r\n                    <Form.Control\r\n                      type=\"number\"\r\n                      value={newChapter.price == 0 ? '0' : newChapter.price}  // 如果 isFree 為 true，顯示 '0'，否則顯示 formParams_1.price\r\n                      placeholder={t('至少 0.01 ETH')}\r\n                      step=\"0.01\"\r\n                      disabled={newChapter.isFree}\r\n                      onChange={(e) => setNewChapter({ ...newChapter, price: e.target.value })}\r\n                    />\r\n                  </Col>\r\n                </Form.Group>\r\n  \r\n                <Form.Group as={Row} className='mb-3'>\r\n                  <div style={{ display: 'flex' }}>\r\n                    <Form.Label column sm={3} className='label-style  '>\r\n                      {t('本章免費')}\r\n                    </Form.Label>\r\n                    <Form.Check\r\n                      type=\"checkbox\"\r\n                      onChange={(e) => {\r\n                        const isFree = e.target.checked;\r\n                        setNewChapter({\r\n                          ...newChapter,\r\n                          isFree: isFree,\r\n                          price: isFree ? 0 : newChapter.price // 如果是免费，则将价格设为 0，否则保持原来的价格\r\n                        });\r\n                      }}\r\n                      checked={newChapter.isFree}\r\n                      style={{ transform: 'scale(1.8)', marginTop: '12px', marginLeft: '1.3rem' }}\r\n                    />\r\n                  </div>\r\n                </Form.Group>\r\n\r\n                <Form.Group className='mb-4'>\r\n                  <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                    <Form.Label className='label-style mb-3 col-form-label'>\r\n                      {t('本章作品上傳')}\r\n                    </Form.Label>\r\n                    <h6 style={{ marginLeft: '10px' }}>\r\n                      {t('如不需變更內容，則無需上傳圖檔')}\r\n                    </h6>\r\n                  </div>\r\n                  <Form.Control\r\n                    type=\"file\"\r\n                    onChange={handleMultiFileInputChange}\r\n                    multiple\r\n                  />\r\n                  <div style={{ display: 'flex', justifyContent: 'space-between', flexWrap: 'wrap' }}>\r\n                    <div style={{ flex: '1 1 45%', textAlign: 'left', marginRight: '10px' }}>\r\n                      <div>{t('更改前的章節內容')}</div>\r\n                      <br />\r\n                      {newChapter.imgURL && (\r\n                        <img\r\n                          src={newChapter.imgURL}\r\n                          alt=\"Preview\"\r\n                          style={{ width: '80%', paddingBottom: '3%' }}\r\n                        />\r\n                      )}\r\n                    </div>\r\n                    <div style={{ flex: '1 1 45%', textAlign: 'right' }}>\r\n                      <div>{t('更改後的章節內容')}</div>\r\n                      <br />\r\n                      <DragDropContext onDragEnd={handleDragEnd}>\r\n                        <Droppable droppableId=\"droppable\">\r\n                          {(provided) => (\r\n                            <div\r\n                              ref={provided.innerRef}\r\n                              {...provided.droppableProps}\r\n                              className=\"image-list\"\r\n                              style={{ display: 'flex', flexWrap: 'wrap', gap: '10px', justifyContent: 'flex-end' }}\r\n                            >\r\n                              {previewImageUrls.map((url, index) => (\r\n                                <Draggable key={index} draggableId={`draggable-${index}`} index={index}>\r\n                                  {(provided) => (\r\n                                    <div\r\n                                      ref={provided.innerRef}\r\n                                      {...provided.draggableProps}\r\n                                      {...provided.dragHandleProps}\r\n                                      className=\"image-item\"\r\n                                      style={{ position: 'relative' }}\r\n                                    >\r\n                                      <img\r\n                                        src={url}\r\n                                        alt={`Preview ${index}`}\r\n                                        className=\"preview-image\"\r\n                                        style={{ width: '80%', height: 'auto', paddingBottom: '3%' }}\r\n                                      />\r\n                                      <button\r\n                                        onClick={() => handleRemoveFile(index)}\r\n                                        type=\"button\"\r\n                                        style={{ backgroundColor: 'white', position: 'absolute', top: '5px', right: '5px' }}\r\n                                        className=\"remove-button\"\r\n                                      >\r\n                                        <MdClose className=\"MdClose-button\" />\r\n                                      </button>\r\n                                      <MdDragHandle\r\n                                        style={{ position: 'absolute', bottom: '5px', right: '5px', cursor: 'grab' }}\r\n                                      />\r\n                                    </div>\r\n                                  )}\r\n                                </Draggable>\r\n                              ))}\r\n                              {provided.placeholder}\r\n                            </div>\r\n                          )}\r\n                        </Droppable>\r\n                      </DragDropContext>\r\n                    </div>\r\n                  </div>\r\n                </Form.Group>\r\n  \r\n                <div className=\"text-red-500 text-center\">{msg}</div>\r\n                <Button onClick={editChapter} id=\"list-button\" data-backgroundcolor=\"#fff\">\r\n                  {t('提交')}\r\n                </Button>\r\n              </Form>\r\n            ) : (\r\n              <Form>\r\n                <Form.Group as={Row} className='mb-3 label-container'>\r\n                  <Form.Label column sm={3} className='label-style label-section'>\r\n                    {t('漫畫名稱')}\r\n                  </Form.Label>\r\n                  <Col sm={9}>\r\n                    <Form.Control\r\n                      type=\"text\"\r\n                      value={newComic.title}\r\n                      onChange={(e) => setNewComic({ ...newComic, title: e.target.value })}\r\n                    />\r\n                  </Col>\r\n                </Form.Group>\r\n  \r\n                <Form.Group as={Row} className='mb-3 label-container'>\r\n                  <Form.Label column sm={3} className='label-style label-section'>\r\n                    {t('漫畫類型')}\r\n                  </Form.Label>\r\n                  <Col sm={9}>\r\n                    <Form.Control\r\n                      as=\"select\"\r\n                      className=\"form-select\"\r\n                      value={t(newComic.category)}\r\n                      onChange={ChoseLevel}\r\n                    >\r\n                      <option>{t('請選擇漫畫類型')}</option>\r\n                      {grading.map((name, index) => (\r\n                        <option key={index}>{t(name)}</option>\r\n                      ))}\r\n                    </Form.Control>\r\n                  </Col>\r\n                </Form.Group>\r\n  \r\n                <Form.Group className='pb-4'>\r\n                  <Form.Label className='label-style mb-3 col-form-label'>{t('漫畫簡介')}</Form.Label>\r\n                  <Form.Control\r\n                    as=\"textarea\"\r\n                    rows={5}\r\n                    value={newComic.description}\r\n                    onChange={(e) => setNewComic({ ...newComic, description: e.target.value })}\r\n                  />\r\n                </Form.Group>\r\n  \r\n                <Form.Group className='pb-5'>\r\n                  <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                    <Form.Label className='label-style mb-1 col-form-label' htmlFor=\"image\">\r\n                      {t('漫畫封面')}\r\n                    </Form.Label>\r\n                    <h6 style={{ marginLeft: '10px' }}>\r\n                      {t('如不需變更封面，則無需上傳圖檔')}\r\n                    </h6>\r\n                  </div>\r\n                  <Form.Control\r\n                    type=\"file\"\r\n                    onChange={handleFileInputChange}\r\n                  />\r\n                  <div style={{ display: 'flex', justifyContent: 'space-between', flexWrap: 'wrap' }}>\r\n                    <div style={{ flex: '1 1 45%', marginRight: '20px', textAlign: 'left' }}>\r\n                      <div>{t('更改前的圖片封面')}</div>\r\n                      <br />\r\n                      <img\r\n                        src={newComic.imgURL}\r\n                        alt=\"Preview\"\r\n                        style={{ width: '80%', maxWidth: '300px', paddingBottom: '3%' }}\r\n                      />\r\n                    </div>\r\n                    <div style={{ flex: '1 1 45%', textAlign: 'right' }}>\r\n                      <div>{t('更改後的圖片封面')}</div>\r\n                      <br />\r\n                      {previewImageUrl && (\r\n                        <div style={{ position: 'relative', display: 'inline-block' }}>\r\n                          <img\r\n                            src={previewImageUrl}\r\n                            alt=\"Preview\"\r\n                            style={{ width: '80%', maxWidth: '300px', paddingBottom: '3%' }}\r\n                          />\r\n                          <button\r\n                            onClick={handleRemoveCover}\r\n                            type=\"button\"\r\n                            style={{ backgroundColor: 'white', position: 'absolute', top: '5px', right: '5px' }}\r\n                            className=\"remove-button\"\r\n                          >\r\n                            <MdClose className=\"MdClose-button\" />\r\n                          </button>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </Form.Group>\r\n  \r\n                <Form.Group className='pb-5'>\r\n                  <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                    <Form.Label className='label-style mb-1 col-form-label' htmlFor=\"image\">\r\n                      {t('漫畫橫向封面')}\r\n                    </Form.Label>\r\n                    <h6 style={{ marginLeft: '10px' }}>\r\n                      {t('如不需變更封面，則無需上傳圖檔')}\r\n                    </h6>\r\n                  </div>\r\n                  <Form.Control\r\n                    type=\"file\"\r\n                    onChange={createPromoCover}\r\n                  />\r\n                  <div style={{ display: 'flex', justifyContent: 'space-between', flexWrap: 'wrap' }}>\r\n                    <div style={{ flex: '1 1 45%', marginRight: '20px', textAlign: 'left' }}>\r\n                      <div>{t('更改前的橫向封面')}</div>\r\n                      <br />\r\n                      {newComic.coverImg ? (\r\n                        <img\r\n                          src={newComic.coverImg}\r\n                          alt=\"Preview\"\r\n                          style={{ width: '80%', maxWidth: '300px', paddingBottom: '3%' }}\r\n                        />\r\n                      ) : (\r\n                        <div>\r\n                          <h3>{t('目前無上傳橫向封面')}</h3>\r\n                          <br />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <div style={{ flex: '1 1 45%', textAlign: 'right' }}>\r\n                      <div>{t('更改後的橫向封面')}</div>\r\n                      <br />\r\n                      {promoPreviewImageUrl && (\r\n                        <div style={{ position: 'relative', display: 'inline-block' }}>\r\n                          <img\r\n                            src={promoPreviewImageUrl}\r\n                            alt=\"Preview\"\r\n                            style={{ width: '80%', maxWidth: '300px', paddingBottom: '3%' }}\r\n                          />\r\n                          <button\r\n                            onClick={handleRemovePromo}\r\n                            type=\"button\"\r\n                            style={{ backgroundColor: 'white', position: 'absolute', top: '5px', right: '5px' }}\r\n                            className=\"remove-button\"\r\n                          >\r\n                            <MdClose className=\"MdClose-button\" />\r\n                          </button>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </Form.Group>\r\n\r\n                <div className=\"text-red-500 text-center\">{msg}</div>\r\n                <Button onClick={editComic} id=\"list-button\" data-backgroundcolor=\"#fff\">\r\n                  {t('提交')}\r\n                </Button>\r\n              </Form>\r\n            )}\r\n          </>\r\n        ) : (\r\n          <div className=\"loading-container\">\r\n            <div>{t('頁面加載中')}</div>\r\n        </div>\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n  \r\n};\r\n\r\nexport default EditWork;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}