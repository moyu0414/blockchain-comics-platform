{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import{Container,Card,Button,Row,Col}from'react-bootstrap';import'./bootstrap.min.css';import{useTranslation}from'react-i18next';import i18n from'../i18n';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const website=process.env.REACT_APP_Website;const API_KEY=process.env.REACT_APP_API_KEY;function MessagePage(){const[comic,setComic]=useState([]);const[loading,setLoading]=useState(true);const[being,setBeing]=useState(true);const{t}=useTranslation();const storedArrayJSON=localStorage.getItem('comicDatas');const storedArray=JSON.parse(storedArrayJSON);const currentAccount=localStorage.getItem(\"currentAccount\");const headers={'api-key':API_KEY};let temp=[];const initData=async()=>{try{const response=await axios.get(\"\".concat(website,\"/api/messagePage\"),{headers:headers,params:{currentAccount:currentAccount}});let data=response.data.collectComic;if(response.data.message=='請先收藏漫畫!'){setBeing(false);setLoading(false);}else{const fetchImage=async item=>{try{const response=await axios.get(\"\".concat(website,\"/api/comicIMG/\").concat(item.comicHash),{responseType:'blob',headers});item.image=URL.createObjectURL(response.data);const storedItem=storedArray.find(stored=>stored.is_exist===0&&stored.comic_id===item.comicHash);if(storedItem){item.comicID=storedItem.comicID;}}catch(error){console.error(\"Error fetching image \".concat(item.comicHash,\": \").concat(error.message));}};if(Array.isArray(data)){await Promise.all(data.map(fetchImage));}else if(typeof data==='object'){await fetchImage(data);}sortByTimestamp(data);setComic(data);setLoading(false);}}catch(error){console.error('Error initializing data:',error);}};useEffect(()=>{initData();},[currentAccount]);function sortByTimestamp(array){return array.sort((a,b)=>{const timestampA=parseInt(a.newCreate);const timestampB=parseInt(b.newCreate);return timestampB-timestampA;// 降序排序\n});}return/*#__PURE__*/_jsx(\"div\",{children:!loading?/*#__PURE__*/_jsx(Container,{className:\"messagePage pt-4\",children:!being?/*#__PURE__*/_jsx(Row,{className:\"pt-5 justify-content-center\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"fw-bold text-center\",children:t('請先收藏漫畫')})}):/*#__PURE__*/_jsx(_Fragment,{children:comic.length===0?/*#__PURE__*/_jsx(Row,{className:\"pt-5 justify-content-center\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"fw-bold text-center\",children:t('目前沒有更新通知')})}):comic.map((message,index)=>/*#__PURE__*/_jsxs(Card,{className:\"mt-4\",style:{display:'flex'},children:[/*#__PURE__*/_jsx(\"div\",{style:{flex:'1'},children:/*#__PURE__*/_jsx(Link,{to:\"/comicDetail/\".concat(message.comicID),children:/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:message.image,alt:message.comicTitle,style:{width:'100%',maxWidth:'100%'}})})}),/*#__PURE__*/_jsx(\"div\",{style:{flex:'2',display:'flex',flexDirection:'column',justifyContent:'center'},children:/*#__PURE__*/_jsxs(Card.Body,{className:\"text-section text-left\",children:[/*#__PURE__*/_jsxs(Card.Title,{children:[t('漫畫'),\"\\uFF1A\",message.comicTitle]}),/*#__PURE__*/_jsxs(Card.Title,{children:[t('章節更新至'),\"\\uFF1A\",message.chapterTitle]})]})})]},index))})}):/*#__PURE__*/_jsx(\"div\",{className:\"loading-container\",children:/*#__PURE__*/_jsx(\"div\",{children:t('頁面加載中')})})});}export default MessagePage;","map":{"version":3,"names":["React","useState","useEffect","Link","Container","Card","Button","Row","Col","useTranslation","i18n","axios","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","website","process","env","REACT_APP_Website","API_KEY","REACT_APP_API_KEY","MessagePage","comic","setComic","loading","setLoading","being","setBeing","t","storedArrayJSON","localStorage","getItem","storedArray","JSON","parse","currentAccount","headers","temp","initData","response","get","concat","params","data","collectComic","message","fetchImage","item","comicHash","responseType","image","URL","createObjectURL","storedItem","find","stored","is_exist","comic_id","comicID","error","console","Array","isArray","Promise","all","map","sortByTimestamp","array","sort","a","b","timestampA","parseInt","newCreate","timestampB","children","className","length","index","style","display","flex","to","Img","variant","src","alt","comicTitle","width","maxWidth","flexDirection","justifyContent","Body","Title","chapterTitle"],"sources":["C:/Users/user1/Desktop/blockchain-comics-platform/frontend/src/routes/messagePage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport { Container, Card, Button, Row,Col } from 'react-bootstrap';\r\nimport './bootstrap.min.css';\r\nimport { useTranslation } from 'react-i18next';\r\nimport i18n from '../i18n';\r\nimport axios from 'axios';\r\nconst website = process.env.REACT_APP_Website;\r\nconst API_KEY = process.env.REACT_APP_API_KEY;\r\n\r\nfunction MessagePage() {\r\n    const [comic, setComic] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [being, setBeing] = useState(true);\r\n    const { t } = useTranslation();\r\n    const storedArrayJSON = localStorage.getItem('comicDatas');\r\n    const storedArray = JSON.parse(storedArrayJSON);\r\n    const currentAccount = localStorage.getItem(\"currentAccount\");\r\n    const headers = {'api-key': API_KEY};\r\n    let temp = [];\r\n\r\n    const initData = async () => {\r\n        try {\r\n            const response = await axios.get(`${website}/api/messagePage`, {\r\n                headers: headers,\r\n                params: {\r\n                    currentAccount: currentAccount,\r\n                }\r\n            });\r\n            let data = response.data.collectComic;\r\n            if (response.data.message == '請先收藏漫畫!') {\r\n                setBeing(false);\r\n                setLoading(false);\r\n            } else {\r\n                const fetchImage = async (item) => {\r\n                    try {\r\n                        const response = await axios.get(`${website}/api/comicIMG/${item.comicHash}`, { responseType: 'blob', headers });\r\n                        item.image = URL.createObjectURL(response.data);\r\n                        const storedItem = storedArray.find(stored => stored.is_exist === 0 && stored.comic_id === item.comicHash);\r\n                        if (storedItem) {\r\n                            item.comicID = storedItem.comicID;\r\n                        }\r\n                    } catch (error) {\r\n                        console.error(`Error fetching image ${item.comicHash}: ${error.message}`);\r\n                    }\r\n                };\r\n                if (Array.isArray(data)) {\r\n                    await Promise.all(data.map(fetchImage));\r\n                } else if (typeof data === 'object') {\r\n                    await fetchImage(data);\r\n                }\r\n                sortByTimestamp(data);\r\n                setComic(data);\r\n                setLoading(false);\r\n            }\r\n        } catch (error) {\r\n            console.error('Error initializing data:', error);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        initData();\r\n    }, [currentAccount]);\r\n\r\n    function sortByTimestamp(array) {\r\n        return array.sort((a, b) => {\r\n            const timestampA = parseInt(a.newCreate);\r\n            const timestampB = parseInt(b.newCreate);\r\n            return timestampB - timestampA; // 降序排序\r\n        });\r\n    }\r\n\r\n\r\n    return (\r\n        <div>\r\n            {!loading ? (\r\n                <Container className='messagePage pt-4'>\r\n                    {!being ? (\r\n                        <Row className='pt-5 justify-content-center'>\r\n                            <h1 className=\"fw-bold text-center\">{t('請先收藏漫畫')}</h1>\r\n                        </Row>\r\n                    ) : (\r\n                        <>\r\n                            {comic.length === 0 ? (\r\n                                <Row className='pt-5 justify-content-center'>\r\n                                    <h1 className=\"fw-bold text-center\">{t('目前沒有更新通知')}</h1>\r\n                                </Row>\r\n                            ) : (\r\n                                comic.map((message, index) => (\r\n                                    <Card className=\"mt-4\" key={index} style={{ display: 'flex' }}>\r\n                                        <div style={{ flex: '1' }}>\r\n                                            <Link to={`/comicDetail/${message.comicID}`}>\r\n                                                <Card.Img variant=\"top\" src={message.image} alt={message.comicTitle} style={{ width: '100%', maxWidth: '100%' }} />\r\n                                            </Link>\r\n                                        </div>\r\n                                        <div style={{ flex: '2', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>\r\n                                            <Card.Body className=\"text-section text-left\">\r\n                                                <Card.Title>{t('漫畫')}：{message.comicTitle}</Card.Title>\r\n                                                <Card.Title>{t('章節更新至')}：{message.chapterTitle}</Card.Title>\r\n                                            </Card.Body>\r\n                                        </div>\r\n                                    </Card>\r\n                                ))\r\n                            )}\r\n                        </>\r\n                    )}\r\n                </Container>\r\n            ) : (\r\n                <div className=\"loading-container\">\r\n                    <div>{t('頁面加載中')}</div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default MessagePage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}